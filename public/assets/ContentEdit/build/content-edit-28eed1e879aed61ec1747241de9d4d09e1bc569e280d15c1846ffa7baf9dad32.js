(function(){var t;t={},t.Machine=function(){function t(t){this.context=t,this._stateTransitions={},this._stateTransitionsAny={},this._defaultTransition=null,this._initialState=null,this._currentState=null}return t.prototype.addTransition=function(t,e,n,r){return n||(n=e),this._stateTransitions[[t,e]]=[n,r]},t.prototype.addTransitions=function(t,e,n,r){var i,s,o,a;for(n||(n=e),a=[],s=0,o=t.length;s<o;s++)i=t[s],a.push(this.addTransition(i,e,n,r));return a},t.prototype.addTransitionAny=function(t,e,n){return e||(e=t),this._stateTransitionsAny[t]=[e,n]},t.prototype.setDefaultTransition=function(t,e){return this._defaultTransition=[t,e]},t.prototype.getTransition=function(t,e){if(this._stateTransitions[[t,e]])return this._stateTransitions[[t,e]];if(this._stateTransitionsAny[e])return this._stateTransitionsAny[e];if(this._defaultTransition)return this._defaultTransition;throw new Error("Transition is undefined: ("+t+", "+e+")")},t.prototype.getCurrentState=function(){return this._currentState},t.prototype.setInitialState=function(t){if(this._initialState=t,!this._currentState)return this.reset()},t.prototype.reset=function(){return this._currentState=this._initialState},t.prototype.process=function(t){var e;return e=this.getTransition(t,this._currentState),e[1]&&e[1].call(this.context||(this.context=this),t),this._currentState=e[0]},t}(),"undefined"!=typeof window&&(window.FSM=t),"undefined"!=typeof module&&module.exports&&(module.exports=t)}).call(this),function(){var t,e,n,r,i,s,o,a,h,u,l,c,p,d,f,m,g,_,y,v,E,T,S,C,b,M,N=[].slice,w=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};_={},"undefined"!=typeof window&&(window.HTMLString=_),"undefined"!=typeof module&&module.exports&&(module.exports=_),_.String=function(){function t(t,e){null==e&&(e=!1),this._preserveWhitespace=e,t?(null===_.String._parser&&(_.String._parser=new M),this.characters=_.String._parser.parse(t,this._preserveWhitespace).characters):this.characters=[]}return t._parser=null,t.prototype.isWhitespace=function(){var t,e,n,r;for(r=this.characters,e=0,n=r.length;e<n;e++)if(t=r[e],!t.isWhitespace())return!1;return!0},t.prototype.length=function(){return this.characters.length},t.prototype.preserveWhitespace=function(){return this._preserveWhitespace},t.prototype.capitalize=function(){var t,e;return e=this.copy(),e.length()&&(t=e.characters[0]._c.toUpperCase(),e.characters[0]._c=t),e},t.prototype.charAt=function(t){return this.characters[t].copy()},t.prototype.concat=function(){var t,e,n,r,i,s,o,a,h,u,l,c,p,d,f,m,g;for(o=2<=arguments.length?N.call(arguments,0,h=arguments.length-1):(h=0,[]),n=arguments[h++],void 0!==n&&"boolean"!=typeof n&&(o.push(n),n=!0),i=this.copy(),u=0,p=o.length;u<p;u++)if(s=o[u],0!==s.length){if(a=s,"string"==typeof s&&(a=new _.String(s,this._preserveWhitespace)),n&&i.length())for(e=i.charAt(i.length()-1),r=e.tags(),e.isTag()&&r.shift(),"string"!=typeof s&&(a=a.copy()),m=a.characters,l=0,d=m.length;l<d;l++)t=m[l],t.addTags.apply(t,r);for(g=a.characters,c=0,f=g.length;c<f;c++)t=g[c],i.characters.push(t)}return i},t.prototype.contains=function(t){var e,n,r,i,s,o,a;if("string"==typeof t)return this.text().indexOf(t)>-1;for(r=0;r<=this.length()-t.length();){for(n=!0,a=t.characters,i=s=0,o=a.length;s<o;i=++s)if(e=a[i],!e.eq(this.characters[i+r])){n=!1;break}if(n)return!0;r++}return!1},t.prototype.endsWith=function(t){var e,n,r,i,s,o;if("string"==typeof t)return""===t||this.text().slice(-t.length)===t;for(n=this.characters.slice().reverse(),o=t.characters.slice().reverse(),r=i=0,s=o.length;i<s;r=++i)if(e=o[r],!e.eq(n[r]))return!1;return!0},t.prototype.format=function(){var t,e,n,r,i,s,o;for(e=arguments[0],s=arguments[1],i=3<=arguments.length?N.call(arguments,2):[],s<0&&(s=this.length()+s+1),e<0&&(e=this.length()+e),r=this.copy(),n=o=e;e<=s?o<s:o>s;n=e<=s?++o:--o)t=r.characters[n],t.addTags.apply(t,i);return r},t.prototype.hasTags=function(){var t,e,n,r,i,s,o,a;for(r=2<=arguments.length?N.call(arguments,0,i=arguments.length-1):(i=0,[]),n=arguments[i++],void 0!==n&&"boolean"!=typeof n&&(r.push(n),n=!1),e=!1,a=this.characters,s=0,o=a.length;s<o;s++)if(t=a[s],t.hasTags.apply(t,r))e=!0;else if(n)return!1;return e},t.prototype.html=function(){var t,e,n,r,i,s,o,a,h,u,l,c,p,d,f,m,g,_,y,v,E,T,S;for(i="",a=[],s=[],n=[],v=this.characters,u=0,d=v.length;u<d;u++){for(t=v[u],n=[],E=a.slice().reverse(),l=0,f=E.length;l<f;l++)if(o=E[l],n.push(o),!t.hasTags(o)){for(c=0,m=n.length;c<m;c++)e=n[c],i+=e.tail(),a.pop(),s.pop();n=[]}for(T=t._tags,p=0,g=T.length;p<g;p++)h=T[p],-1===s.indexOf(h.head())&&(h.selfClosing()||(r=h.head(),i+=r,a.push(h),s.push(r)));t._tags.length>0&&t._tags[0].selfClosing()&&(i+=t._tags[0].head()),i+=t.c()}for(S=a.reverse(),y=0,_=S.length;y<_;y++)h=S[y],i+=h.tail();return i},t.prototype.indexOf=function(t,e){var n,r,i,s,o,a;if(null==e&&(e=0),e<0&&(e=0),"string"==typeof t)return this.text().indexOf(t,e);for(;e<=this.length()-t.length();){for(r=!0,a=t.characters,i=s=0,o=a.length;s<o;i=++s)if(n=a[i],!n.eq(this.characters[i+e])){r=!1;break}if(r)return e;e++}return-1},t.prototype.insert=function(t,e,n){var r,i,s,o,a,h,u,l,c,p,d,f,m,g,y,v;if(null==n&&(n=!0),i=this.slice(0,t),u=this.slice(t),t<0&&(t=this.length()+t),a=e,"string"==typeof e&&(a=new _.String(e,this._preserveWhitespace)),n&&t>0)for(s=this.charAt(t-1),o=s.tags(),s.isTag()&&o.shift(),"string"!=typeof e&&(a=a.copy()),g=a.characters,l=0,d=g.length;l<d;l++)r=g[l],r.addTags.apply(r,o);for(h=i,y=a.characters,c=0,f=y.length;c<f;c++)r=y[c],h.characters.push(r);for(v=u.characters,p=0,m=v.length;p<m;p++)r=v[p],h.characters.push(r);return h},t.prototype.lastIndexOf=function(t,e){var n,r,i,s,o,a,h,u,l;if(null==e&&(e=0),e<0&&(e=0),r=this.characters.slice(e).reverse(),e=0,"string"==typeof t){if(!this.contains(t))return-1;for(t=t.split("").reverse();e<=r.length-t.length;){for(i=!0,o=0,s=a=0,u=t.length;a<u;s=++a)if(n=t[s],r[s+e].isTag()&&(o+=1),n!==r[o+s+e].c()){i=!1;break}if(i)return e;e++}return-1}for(t=t.characters.slice().reverse();e<=r.length-t.length;){for(i=!0,s=h=0,l=t.length;h<l;s=++h)if(n=t[s],!n.eq(r[s+e])){i=!1;break}if(i)return e;e++}return-1},t.prototype.optimize=function(){var t,e,n,r,i,s,o,a,h,u,l,c,p,d,f,m,g,_,y,v,E,T,S,C,b,M,N,w,x,L,D,R,I,O,A;for(a=[],s=[],r=null,x=this.characters.slice().reverse(),f=0,y=x.length;f<y;f++){for(t=x[f],t._runLengthMap={},t._runLengthMapSize=0,e=[],L=a.slice().reverse(),m=0,v=L.length;m<v;m++)if(o=L[m],e.push(o),!t.hasTags(o)){for(g=0,E=e.length;g<E;g++)e[g],a.pop(),s.pop();e=[]}for(D=t._tags,_=0,T=D.length;_<T;_++)d=D[_],-1===s.indexOf(d.head())&&(d.selfClosing()||(a.push(d),s.push(d.head())));for(M=0,S=a.length;M<S;M++)d=a[M],n=d.head(),r?(t._runLengthMap[n]||(t._runLengthMap[n]=[d,0]),c=0,r._runLengthMap[n]&&(c=r._runLengthMap[n][1]),t._runLengthMap[n][1]=c+1):t._runLengthMap[n]=[d,1];r=t}for(u=function(t,e){return e[1]-t[1]},R=this.characters,A=[],N=0,C=R.length;N<C;N++)if(t=R[N],!((i=t._tags.length)>0&&t._tags[0].selfClosing()&&i<3||i<2)){l=[],I=t._runLengthMap;for(d in I)h=I[d],l.push(h);for(l.sort(u),O=t._tags.slice(),w=0,b=O.length;w<b;w++)d=O[w],d.selfClosing()||t.removeTags(d);A.push(t.addTags.apply(t,function(){var t,e,n;for(n=[],e=0,t=l.length;e<t;e++)p=l[e],n.push(p[0]);return n}()))}return A},t.prototype.slice=function(t,e){var n,r;return r=new _.String("",this._preserveWhitespace),r.characters=function(){var r,i,s,o;for(s=this.characters.slice(t,e),o=[],r=0,i=s.length;r<i;r++)n=s[r],o.push(n.copy());return o}.call(this),r},t.prototype.split=function(t,e){var n,r,i,s,o,a,h,u,l,c;for(null==t&&(t=""),null==e&&(e=0),a=0,n=0,o=[0];;){if(e>0&&n>e)break;if(-1===(s=this.indexOf(t,a)))break;o.push(s),a=s+1}for(o.push(this.length()),u=[],i=l=0,c=o.length-2;0<=c?l<=c:l>=c;i=0<=c?++l:--l)h=o[i],i>0&&(h+=1),r=o[i+1],u.push(this.slice(h,r));return u},t.prototype.startsWith=function(t){var e,n,r,i,s;if("string"==typeof t)return this.text().slice(0,t.length)===t;for(s=t.characters,n=r=0,i=s.length;r<i;n=++r)if(e=s[n],!e.eq(this.characters[n]))return!1;return!0},t.prototype.substr=function(t,e){return e<=0?new _.String("",this._preserveWhitespace):(t<0&&(t=this.length()+t),void 0===e&&(e=this.length()-t),this.slice(t,t+e))},t.prototype.substring=function(t,e){return void 0===e&&(e=this.length()),this.slice(t,e)},t.prototype.text=function(){var t,e,n,r,i;for(e="",i=this.characters,n=0,r=i.length;n<r;n++)t=i[n],t.isTag()?t.isTag("br")&&(e+="\n"):(t.c(),e+=t.c());return this.constructor.decode(e)},t.prototype.toLowerCase=function(){var t,e,n,r,i;for(e=this.copy(),i=e.characters,n=0,r=i.length;n<r;n++)t=i[n],1===t._c.length&&(t._c=t._c.toLowerCase());return e},t.prototype.toUpperCase=function(){var t,e,n,r,i;for(e=this.copy(),i=e.characters,n=0,r=i.length;n<r;n++)t=i[n],1===t._c.length&&(t._c=t._c.toUpperCase());return e},t.prototype.trim=function(){var t,e,n,r,i,s,o,a,h,u;for(h=this.characters,e=i=0,o=h.length;i<o&&(t=h[e],t.isWhitespace());e=++i);for(u=this.characters.slice().reverse(),r=s=0,a=u.length;s<a&&(t=u[r],t.isWhitespace());r=++s);return r=this.length()-r-1,n=new _.String("",this._preserveWhitespace),n.characters=function(){var n,i,s,o;for(s=this.characters.slice(e,+r+1||9e9),o=[],n=0,i=s.length;n<i;n++)t=s[n],o.push(t.copy());return o}.call(this),n},t.prototype.trimLeft=function(){var t,e,n,r,i,s,o;for(r=this.length()-1,o=this.characters,e=i=0,s=o.length;i<s&&(t=o[e],t.isWhitespace());e=++i);return n=new _.String("",this._preserveWhitespace),n.characters=function(){var n,i,s,o;for(s=this.characters.slice(e,+r+1||9e9),o=[],n=0,i=s.length;n<i;n++)t=s[n],o.push(t.copy());return o}.call(this),n},t.prototype.trimRight=function(){var t,e,n,r,i,s,o;for(e=0,o=this.characters.slice().reverse(),r=i=0,s=o.length;i<s&&(t=o[r],t.isWhitespace());r=++i);return r=this.length()-r-1,n=new _.String("",this._preserveWhitespace),n.characters=function(){var n,i,s,o;for(s=this.characters.slice(e,+r+1||9e9),o=[],n=0,i=s.length;n<i;n++)t=s[n],o.push(t.copy());return o}.call(this),n},t.prototype.unformat=function(){var t,e,n,r,i,s,o;for(e=arguments[0],s=arguments[1],i=3<=arguments.length?N.call(arguments,2):[],s<0&&(s=this.length()+s+1),e<0&&(e=this.length()+e),r=this.copy(),n=o=e;e<=s?o<s:o>s;n=e<=s?++o:--o)t=r.characters[n],t.removeTags.apply(t,i);return r},t.prototype.copy=function(){var t,e;return e=new _.String("",this._preserveWhitespace),e.characters=function(){var e,n,r,i;for(r=this.characters,i=[],e=0,n=r.length;e<n;e++)t=r[e],i.push(t.copy());return i}.call(this),e},t.decode=function(t){var e;return e=document.createElement("textarea"),e.innerHTML=t,e.textContent},t.encode=function(t){var e;return e=document.createElement("textarea"),e.textContent=t,e.innerHTML},t.join=function(t,e){var n,r,i,s;for(n=e.shift(),i=0,s=e.length;i<s;i++)r=e[i],n=n.concat(t,r);return n},t}(),t="AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz-_$".split(""),e=t.concat("1234567890".split("")),a=e.concat([":"]),g=e.concat(["#"]),E=e.concat([":"]),d=1,m=2,v=3,y=4,f=5,C=6,T=7,b=8,S=9,u=10,o=11,h=12,n=13,p=14,l=15,c=16,i=17,s=18,r=19,M=function(){function M(){this.fsm=new FSM.Machine(this),this.fsm.setInitialState(d),this.fsm.addTransitionAny(d,null,function(t){return this._pushChar(t)}),this.fsm.addTransition("<",d,v),this.fsm.addTransition("&",d,m),this.fsm.addTransitions(g,m,null,function(t){return this.entity+=t}),this.fsm.addTransition(";",m,d,function(){return this._pushChar("&"+this.entity+";"),this.entity=""}),this.fsm.addTransitions([" ","\n"],v),this.fsm.addTransitions(t,v,y,function(){return this._back()}),this.fsm.addTransition("/",v,f),this.fsm.addTransitions([" ","\n"],y),this.fsm.addTransitions(t,y,C,function(){return this._back()}),this.fsm.addTransitions([" ","\n"],f),this.fsm.addTransitions(t,f,T,function(){return this._back()}),this.fsm.addTransitions(E,C,null,function(t){return this.tagName+=t}),this.fsm.addTransitions([" ","\n"],C,u),this.fsm.addTransition("/",C,b,function(){return this.selfClosing=!0}),this.fsm.addTransition(">",C,d,function(){return this._pushTag()}),this.fsm.addTransitions([" ","\n"],b),this.fsm.addTransition(">",b,d,function(){return this._pushTag()}),this.fsm.addTransitions([" ","\n"],u),this.fsm.addTransition("/",u,b,function(){return this.selfClosing=!0}),this.fsm.addTransition(">",u,d,function(){return this._pushTag()}),this.fsm.addTransitions(t,u,o,function(){return this._back()}),this.fsm.addTransitions(E,T,null,function(t){return this.tagName+=t}),this.fsm.addTransitions([" ","\n"],T,S),this.fsm.addTransition(">",T,d,function(){return this._popTag()}),this.fsm.addTransitions([" ","\n"],S),this.fsm.addTransition(">",S,d,function(){return this._popTag()}),this.fsm.addTransitions(a,o,null,function(t){return this.attributeName+=t}),this.fsm.addTransitions([" ","\n"],o,h),this.fsm.addTransition("=",o,n),this.fsm.addTransitions([" ","\n"],h),this.fsm.addTransition("=",h,n),this.fsm.addTransitions(">",o,u,function(){return this._pushAttribute(),this._back()}),this.fsm.addTransitionAny(h,u,function(){return this._pushAttribute(),this._back()}),this.fsm.addTransitions([" ","\n"],n),this.fsm.addTransition("'",n,p),this.fsm.addTransition('"',n,l),this.fsm.addTransitions(e.concat(["&"],n,c,function(){return this._back()})),this.fsm.addTransition(" ",c,u,function(){return this._pushAttribute()}),this.fsm.addTransitions(["/",">"],c,u,function(){return this._back(),this._pushAttribute()}),this.fsm.addTransition("&",c,i),this.fsm.addTransitionAny(c,null,function(t){return this.attributeValue+=t}),this.fsm.addTransition("'",p,u,function(){return this._pushAttribute()}),this.fsm.addTransition("&",p,s),this.fsm.addTransitionAny(p,null,function(t){return this.attributeValue+=t}),this.fsm.addTransition('"',l,u,function(){return this._pushAttribute()}),this.fsm.addTransition("&",l,r),this.fsm.addTransitionAny(l,null,function(t){return this.attributeValue+=t}),this.fsm.addTransitions(g,i,null,function(t){return this.entity+=t}),this.fsm.addTransitions(g,s,function(t){return this.entity+=t}),this.fsm.addTransitions(g,r,null,function(t){return this.entity+=t}),this.fsm.addTransition(";",i,c,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""}),this.fsm.addTransition(";",s,p,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""}),this.fsm.addTransition(";",r,l,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""})}return M.prototype._back=function(){return this.head--},M.prototype._pushAttribute=function(){return this.attributes[this.attributeName]=this.attributeValue,this.attributeName="",this.attributeValue=""},M.prototype._pushChar=function(t){var e,n;return e=new _.Character(t,this.tags),this._preserveWhitespace?void this.string.characters.push(e):!this.string.length()||e.isTag()||e.isEntity()||!e.isWhitespace()||(n=this.string.characters[this.string.length()-1],!n.isWhitespace()||n.isTag()||n.isEntity())?this.string.characters.push(e):void 0},M.prototype._pushTag=function(){var t,e;return t=new _.Tag(this.tagName,this.attributes),this.tags.push(t),t.selfClosing()&&(this._pushChar(""),this.tags.pop(),!this.selfClosed&&(e=this.tagName,w.call(_.Tag.SELF_CLOSING,e)>=0)&&this.fsm.reset()),this.tagName="",this.selfClosed=!1,this.attributes={}},M.prototype._popTag=function(){for(var t,e;;)if(e=this.tags.pop(),this.string.length()&&(t=this.string.characters[this.string.length()-1],t.isTag()||t.isEntity()||!t.isWhitespace()||t.removeTags(e)),e.name()===this.tagName.toLowerCase())break;return this.tagName=""},M.prototype.parse=function(t,e){var n,r;for(this._preserveWhitespace=e,this.reset(),t=this.preprocess(t),this.fsm.parser=this;this.head<t.length;){n=t[this.head];try{this.fsm.process(n)}catch(t){throw r=t,new Error("Error at char "+this.head+" >> "+r)}this.head++}return this.string},M.prototype.preprocess=function(t){return t=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),t=t.replace(/<!--[\s\S]*?-->/g,""),this._preserveWhitespace||(t=t.replace(/\s+/g," ")),t},M.prototype.reset=function(){return this.fsm.reset(),this.head=0,this.string=new _.String,this.entity="",this.tags=[],this.tagName="",this.selfClosing=!1,this.attributes={},this.attributeName="",this.attributeValue=""},M}(),_.Tag=function(){function t(t,e){var n,r;this._name=t.toLowerCase(),this._selfClosing=!0===_.Tag.SELF_CLOSING[this._name],this._head=null,this._attributes={};for(n in e)r=e[n],this._attributes[n]=r}return t.SELF_CLOSING={area:!0,base:!0,br:!0,hr:!0,img:!0,input:!0,"link meta":!0,wbr:!0},t.prototype.head=function(){var t,e,n,r;if(!this._head){t=[],r=this._attributes;for(e in r)n=r[e],n?t.push(e+'="'+n+'"'):t.push(""+e);t.sort(),t.unshift(this._name),this._head="<"+t.join(" ")+">"}return this._head},t.prototype.name=function(){return this._name},t.prototype.selfClosing=function(){return this._selfClosing},t.prototype.tail=function(){return this._selfClosing?"":"</"+this._name+">"},t.prototype.attr=function(t,e){return void 0===e?this._attributes[t]:(this._attributes[t]=e,this._head=null)},t.prototype.removeAttr=function(t){if(void 0!==this._attributes[t])return delete this._attributes[t],this._head=null},t.prototype.copy=function(){return new _.Tag(this._name,this._attributes)},t}(),_.Character=function(){function t(t,e){this._c=t,t.length>1&&(this._c=t.toLowerCase()),this._tags=[],this.addTags.apply(this,e)}return t.prototype.c=function(){return this._c},t.prototype.isEntity=function(){return this._c.length>1},t.prototype.isTag=function(t){return!(0===this._tags.length||!this._tags[0].selfClosing())&&(!t||this._tags[0].name()===t)},t.prototype.isWhitespace=function(){var t;return" "===(t=this._c)||"\n"===t||"&nbsp;"===t||this.isTag("br")},t.prototype.tags=function(){var t;return function(){var e,n,r,i;for(r=this._tags,i=[],e=0,n=r.length;e<n;e++)t=r[e],i.push(t.copy());return i}.call(this)},t.prototype.addTags=function(){var t,e,n,r,i;for(e=1<=arguments.length?N.call(arguments,0):[],i=[],n=0,r=e.length;n<r;n++)t=e[n],Array.isArray(t)||(t.selfClosing()?this.isTag()||this._tags.unshift(t.copy()):i.push(this._tags.push(t.copy())));return i},t.prototype.eq=function(t){var e,n,r,i,s,o,a,h;if(this.c()!==t.c())return!1;if(this._tags.length!==t._tags.length)return!1;for(n={},a=this._tags,r=0,s=a.length;r<s;r++)e=a[r],n[e.head()]=!0;for(h=t._tags,i=0,o=h.length;i<o;i++)if(e=h[i],!n[e.head()])return!1;return!0},t.prototype.hasTags=function(){var t,e,n,r,i,s,o,a,h;for(r=1<=arguments.length?N.call(arguments,0):[],n={},e={},h=this._tags,i=0,o=h.length;i<o;i++)t=h[i],n[t.name()]=!0,e[t.head()]=!0;for(s=0,a=r.length;s<a;s++)if("string"==typeof(t=r[s])){if(void 0===n[t])return!1}else if(void 0===e[t.head()])return!1;return!0},t.prototype.removeTags=function(){var t,e,n,r,i,s;if(r=1<=arguments.length?N.call(arguments,0):[],0===r.length)return void(this._tags=[]);for(e={},t={},i=0,s=r.length;i<s;i++)n=r[i],"string"==typeof n?e[n]=n:t[n.head()]=n;return[],this._tags=this._tags.filter(function(n){if(!t[n.head()]&&!e[n.name()])return n})},t.prototype.copy=function(){var t;return new _.Character(this._c,function(){var e,n,r,i;for(r=this._tags,i=[],e=0,n=r.length;e<n;e++)t=r[e],i.push(t.copy());return i}.call(this))},t}()}.call(this),function(){var t,e,n,r,i,s,o=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};t={},t.Range=function(){function o(t,e){this.set(t,e)}return o.prototype.isCollapsed=function(){return this._from===this._to},o.prototype.span=function(){return this._to-this._from},o.prototype.collapse=function(){return this._to=this._from},o.prototype.eq=function(t){return this.get()[0]===t.get()[0]&&this.get()[1]===t.get()[1]},o.prototype.get=function(){return[this._from,this._to]},o.prototype.select=function(e){var n,i,s,o,a,h,u,l,c;return t.Range.unselectAll(),n=document.createRange(),l=r(e,this._from),a=l[0],u=l[1],c=r(e,this._to),i=c[0],o=c[1],h=a.length||0,s=i.length||0,n.setStart(a,Math.min(u,h)),n.setEnd(i,Math.min(o,s)),window.getSelection().addRange(n)},o.prototype.set=function(t,e){return t=Math.max(0,t),e=Math.max(0,e),this._from=Math.min(t,e),this._to=Math.max(t,e)},o.prepareElement=function(t){var n,r,i,s,o,a;for(i=t.querySelectorAll(e.join(", ")),a=[],n=s=0,o=i.length;s<o;n=++s)r=i[n],r.parentNode.insertBefore(document.createTextNode(""),r),n<i.length-1?a.push(r.parentNode.insertBefore(document.createTextNode(""),r.nextSibling)):a.push(void 0);return a},o.query=function(e){var r,o,a,h,u,l,c;h=new t.Range(0,0);try{r=window.getSelection().getRangeAt(0)}catch(t){return h}return null===e.firstChild&&null===e.lastChild?h:n(r.startContainer,e)&&n(r.endContainer,e)?(c=i(e,r),u=c[0],l=c[1],o=c[2],a=c[3],h.set(s(e,u)+l,s(e,o)+a),h):h},o.rect=function(){var t,e,n;try{t=window.getSelection().getRangeAt(0)}catch(t){return null}return t.collapsed?(e=document.createElement("span"),t.insertNode(e),n=e.getBoundingClientRect(),e.parentNode.removeChild(e),n):t.getBoundingClientRect()},o.unselectAll=function(){if(window.getSelection())return window.getSelection().removeAllRanges()},o}(),e=["br","img","input"],n=function(t,e){for(;t;){if(t===e)return!0;t=t.parentNode}return!1},r=function(t,n){var r,i,s,a,h;if(0===t.childNodes.length)return[t,n];for(r=null,i=n,s=function(){var e,n,r,i;for(r=t.childNodes,i=[],e=0,n=r.length;e<n;e++)a=r[e],i.push(a);return i}();s.length>0;)switch(r=s.shift(),r.nodeType){case Node.TEXT_NODE:if(r.textContent.length>=i)return[r,i];i-=r.textContent.length;break;case Node.ELEMENT_NODE:if(h=r.nodeName.toLowerCase(),o.call(e,h)>=0){if(0===i)return[r,0];i=Math.max(0,i-1)}else r.childNodes&&Array.prototype.unshift.apply(s,function(){var t,e,n,i;for(n=r.childNodes,i=[],t=0,e=n.length;t<e;t++)a=n[t],i.push(a);return i}())}return[r,i]},s=function(t,n){var r,i,s,a,h,u;if(0===t.childNodes.length)return 0;for(s=0,r=function(){var e,n,r,s;for(r=t.childNodes,s=[],e=0,n=r.length;e<n;e++)i=r[e],s.push(i);return s}();r.length>0;){if((a=r.shift())===n)return h=a.nodeName.toLowerCase(),o.call(e,h)>=0?s+1:s;switch(a.nodeType){case Node.TEXT_NODE:s+=a.textContent.length;break;case Node.ELEMENT_NODE:u=a.nodeName.toLowerCase(),o.call(e,u)>=0?s+=1:a.childNodes&&Array.prototype.unshift.apply(r,function(){var t,e,n,r;for(n=a.childNodes,r=[],t=0,e=n.length;t<e;t++)i=n[t],r.push(i);return r}())}}return s},i=function(t,n){var r,i,s,a,h,u,l,c,p,d,f,m,g,_;if(i=t.childNodes,p=n.cloneRange(),p.collapse(!0),h=n.cloneRange(),h.collapse(!1),l=p.startContainer,c=p.startOffset,s=h.endContainer,a=h.endOffset,!p.comparePoint)return[l,c,s,a];if(l===t)for(l=i[i.length-1],c=l.textContent.length,u=d=0,m=i.length;d<m;u=++d)if(r=i[u],1===p.comparePoint(r,0)){0===u?(l=r,c=0):(l=i[u-1],c=r.textContent.length),_=l.nodeName.toLowerCase,o.call(e,_)>=0&&(c=1);break}if(n.collapsed)return[l,c,l,c];if(s===t)for(s=i[i.length-1],a=s.textContent.length,u=f=0,g=i.length;f<g;u=++f)r=i[u],1===h.comparePoint(r,0)&&(s=0===u?r:i[u-1],a=r.textContent.length+1);return[l,c,s,a]},"undefined"!=typeof window&&(window.ContentSelect=t),"undefined"!=typeof module&&module.exports&&(module.exports=t)}.call(this),function(){var t,e,n,r,i=[].slice,s=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},o={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h=function(t,e){return function(){return t.apply(e,arguments)}};t={ALIGNMENT_CLASS_NAMES:{left:"align-left",right:"align-right"},DEFAULT_MAX_ELEMENT_WIDTH:800,DEFAULT_MIN_ELEMENT_WIDTH:80,DRAG_HOLD_DURATION:500,DROP_EDGE_SIZE:50,HELPER_CHAR_LIMIT:250,INDENT:"    ",LANGUAGE:"en",LINE_ENDINGS:"\n",PREFER_LINE_BREAKS:!1,RESIZE_CORNER_SIZE:15,TRIM_WHITESPACE:!0,_translations:{},_:function(e){var n;return n=t.LANGUAGE,t._translations[n]&&t._translations[n][e]?t._translations[n][e]:e},addTranslations:function(e,n){return t._translations[e]=n},addCSSClass:function(t,e){var n,r,i;return t.classList?void t.classList.add(e):(r=t.getAttribute("class"),r?(i=function(){var t,e,i,s;for(i=r.split(" "),s=[],t=0,e=i.length;t<e;t++)n=i[t],s.push(n);return s}(),-1===i.indexOf(e)?t.setAttribute("class",r+" "+e):void 0):t.setAttribute("class",e))},attributesToString:function(t){var e,n,r,i,s,o;if(!t)return"";for(r=function(){var e;e=[];for(n in t)e.push(n);return e}(),r.sort(),e=[],s=0,o=r.length;s<o;s++)n=r[s],i=t[n],""===i?e.push(n):(i=HTMLString.String.encode(i),i=i.replace(/"/g,"&quot;"),e.push(n+'="'+i+'"'));return e.join(" ")},removeCSSClass:function(t,e){var n,r,i,s;return t.classList?(t.classList.remove(e),void(0===t.classList.length&&t.removeAttribute("class"))):(r=t.getAttribute("class"),r&&(s=function(){var t,e,i,s;for(i=r.split(" "),s=[],t=0,e=i.length;t<e;t++)n=i[t],s.push(n);return s}(),(i=s.indexOf(e))>-1)?(s.splice(i,1),s.length?t.setAttribute("class",s.join(" ")):t.removeAttribute("class")):void 0)}},"undefined"!=typeof window&&(window.ContentEdit=t),"undefined"!=typeof module&&module.exports&&(module.exports=t),n=function(){function e(){this._tagNames={}}return e.prototype.register=function(){var t,e,n,r,s,o;for(t=arguments[0],n=2<=arguments.length?i.call(arguments,1):[],o=[],r=0,s=n.length;r<s;r++)e=n[r],o.push(this._tagNames[e.toLowerCase()]=t);return o},e.prototype.match=function(e){return e=e.toLowerCase(),this._tagNames[e]?this._tagNames[e]:t.Static},e}(),t.TagNames=function(){function t(){}var e;return e=null,t.get=function(){return null!=e?e:e=new n},t}(),t.Node=function(){function e(){this._bindings={},this._parent=null,this._modified=null}return e.prototype.lastModified=function(){return this._modified},e.prototype.parent=function(){return this._parent},e.prototype.parents=function(){var t,e;for(e=[],t=this._parent;t;)e.push(t),t=t._parent;return e},e.prototype.type=function(){return"Node"},e.prototype.html=function(t){throw null==t&&(t=""),new Error("`html` not implemented")},e.prototype.bind=function(t,e){return void 0===this._bindings[t]&&(this._bindings[t]=[]),this._bindings[t].push(e),e},e.prototype.trigger=function(){var t,e,n,r,s,o,a;if(n=arguments[0],t=2<=arguments.length?i.call(arguments,1):[],this._bindings[n]){for(o=this._bindings[n],a=[],r=0,s=o.length;r<s;r++)(e=o[r])&&a.push(e.call.apply(e,[this].concat(i.call(t))));return a}},e.prototype.unbind=function(t,e){var n,r,i,s,o,a;if(!t)return void(this._bindings={});if(!e)return void(this._bindings[t]=void 0);if(this._bindings[t]){for(o=this._bindings[t],a=[],n=i=0,s=o.length;i<s;n=++i)r=o[n],r===e?a.push(this._bindings[t].splice(n,1)):a.push(void 0);return a}},e.prototype.commit=function(){return this._modified=null,t.Root.get().trigger("commit",this)},e.prototype.taint=function(){var e,n,r,i,s,o;for(e=Date.now(),this._modified=e,o=this.parents(),i=0,s=o.length;i<s;i++)n=o[i],n._modified=e;return r=t.Root.get(),r._modified=e,r.trigger("taint",this)},e.prototype.closest=function(t){var e;for(e=this.parent();e&&!t(e);)e=e.parent?e.parent():null;return e},e.prototype.next=function(){var t,e,n,r,i,s;if(this.children&&this.children.length>0)return this.children[0];for(s=[this].concat(this.parents()),r=0,i=s.length;r<i;r++){if(n=s[r],!n.parent())return null;if(t=n.parent().children,(e=t.indexOf(n))<t.length-1)return t[e+1]}},e.prototype.nextContent=function(){return this.nextWithTest(function(t){return void 0!==t.content})},e.prototype.nextSibling=function(){var t;return t=this.parent().children.indexOf(this),t===this.parent().children.length-1?null:this.parent().children[t+1]},e.prototype.nextWithTest=function(t){var e;for(e=this;e;)if((e=e.next())&&t(e))return e},e.prototype.previous=function(){var t,e;if(!this.parent())return null;if(t=this.parent().children,t[0]===this)return this.parent();for(e=t[t.indexOf(this)-1];e.children&&e.children.length;)e=e.children[e.children.length-1];return e},e.prototype.previousContent=function(){return this.previousWithTest(function(t){return void 0!==t.content})},e.prototype.previousSibling=function(){var t;return t=this.parent().children.indexOf(this),0===t?null:this.parent().children[t-1]},e.prototype.previousWithTest=function(t){var e;for(e=this;e;)if((e=e.previous())&&t(e))return e},e.extend=function(t){var e,n,r;r=t.prototype;for(e in r)n=r[e],"constructor"!==e&&(this.prototype[e]=n);for(e in t)n=t[e],s.call("__super__",e)>=0||(this.prototype[e]=n);return this},e.fromDOMElement=function(){throw new Error("`fromDOMElement` not implemented")},e}(),t.NodeCollection=function(e){function n(){n.__super__.constructor.call(this),this.children=[]}return a(n,e),n.prototype.descendants=function(){var t,e,n;for(t=[],n=this.children.slice();n.length>0;)e=n.shift(),t.push(e),e.children&&e.children.length>0&&(n=e.children.slice().concat(n));return t},n.prototype.isMounted=function(){return!1},n.prototype.type=function(){return"NodeCollection"},n.prototype.attach=function(e,n){return e.parent()&&e.parent().detach(e),e._parent=this,void 0!==n?this.children.splice(n,0,e):this.children.push(e),e.mount&&this.isMounted()&&e.mount(),this.taint(),t.Root.get().trigger("attach",this,e)},n.prototype.commit=function(){var e,n,r,i;for(i=this.descendants(),n=0,r=i.length;n<r;n++)e=i[n],e._modified=null;return this._modified=null,t.Root.get().trigger("commit",this)},n.prototype.detach=function(e){var n;if(-1!==(n=this.children.indexOf(e)))return e.unmount&&this.isMounted()&&e.isMounted()&&e.unmount(),this.children.splice(n,1),e._parent=null,this.taint(),t.Root.get().trigger("detach",this,e)},n}(t.Node),t.Element=function(e){function n(t,e){n.__super__.constructor.call(this),this._tagName=t.toLowerCase(),this._attributes=e||{},this._domElement=null,this._behaviours={drag:!0,drop:!0,merge:!0,remove:!0,resize:!0,spawn:!0}}return a(n,e),n.prototype.attributes=function(){var t,e,n,r;t={},r=this._attributes;for(e in r)n=r[e],t[e]=n;return t},n.prototype.cssTypeName=function(){return"element"},n.prototype.domElement=function(){return this._domElement},n.prototype.isFixed=function(){return this.parent()&&"Fixture"===this.parent().type()},n.prototype.isFocused=function(){return t.Root.get().focused()===this},n.prototype.isMounted=function(){return null!==this._domElement},n.prototype.type=function(){return"Element"},n.prototype.typeName=function(){return"Element"},n.prototype.addCSSClass=function(t){var e;if(e=!1,this.hasCSSClass(t)||(e=!0,this.attr("class")?this.attr("class",this.attr("class")+" "+t):this.attr("class",t)),this._addCSSClass(t),e)return this.taint()},n.prototype.attr=function(t,e){return t=t.toLowerCase(),void 0===e?this._attributes[t]:(this._attributes[t]=e,this.isMounted()&&"class"!==t.toLowerCase()&&this._domElement.setAttribute(t,e),this.taint())},n.prototype.blur=function(){var e;if(e=t.Root.get(),this.isFocused())return this._removeCSSClass("ce-element--focused"),e._focused=null,e.trigger("blur",this)},n.prototype.can=function(t,e){return void 0===e?!this.isFixed()&&this._behaviours[t]:this._behaviours[t]=e},n.prototype.createDraggingDOMElement=function(){var e;if(this.isMounted())return e=document.createElement("div"),e.setAttribute("class","ce-drag-helper ce-drag-helper--type-"+this.cssTypeName()),e.setAttribute("data-ce-type",t._(this.typeName())),e},n.prototype.drag=function(e,n){var r;if(this.isMounted()&&this.can("drag"))return r=t.Root.get(),r.startDragging(this,e,n),r.trigger("drag",this)},n.prototype.drop=function(e,n){var r;if(this.can("drop")){if(r=t.Root.get(),e){if(e._removeCSSClass("ce-element--drop"),e._removeCSSClass("ce-element--drop-"+n[0]),e._removeCSSClass("ce-element--drop-"+n[1]),this.constructor.droppers[e.type()])return this.constructor.droppers[e.type()](this,e,n),void r.trigger("drop",this,e,n);if(e.constructor.droppers[this.type()])return e.constructor.droppers[this.type()](this,e,n),void r.trigger("drop",this,e,n)}return r.trigger("drop",this,null,null)}},n.prototype.focus=function(e){var n;if(n=t.Root.get(),!this.isFocused())return n.focused()&&n.focused().blur(),this._addCSSClass("ce-element--focused"),n._focused=this,this.isMounted()&&!e&&this.domElement().focus(),n.trigger("focus",this)},n.prototype.hasCSSClass=function(t){var e,n;return!!(this.attr("class")&&(n=function(){var t,n,r,i;for(r=this.attr("class").split(" "),i=[],t=0,n=r.length;t<n;t++)e=r[t],i.push(e);return i}.call(this),n.indexOf(t)>-1))},n.prototype.merge=function(t){return!(!this.can("merge")||!this.can("remove"))&&(this.constructor.mergers[t.type()]?this.constructor.mergers[t.type()](t,this):t.constructor.mergers[this.type()]?t.constructor.mergers[this.type()](t,this):void 0)},n.prototype.mount=function(){var e;return this._domElement||(this._domElement=document.createElement(this.tagName())),e=this.nextSibling(),
e?this.parent().domElement().insertBefore(this._domElement,e.domElement()):this.isFixed()?(this.parent().domElement().parentNode.replaceChild(this._domElement,this.parent().domElement()),this.parent()._domElement=this._domElement):this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),this._addCSSClass("ce-element"),this._addCSSClass("ce-element--type-"+this.cssTypeName()),this.isFocused()&&this._addCSSClass("ce-element--focused"),t.Root.get().trigger("mount",this)},n.prototype.removeAttr=function(t){if(t=t.toLowerCase(),this._attributes[t])return delete this._attributes[t],this.isMounted()&&"class"!==t.toLowerCase()&&this._domElement.removeAttribute(t),this.taint()},n.prototype.removeCSSClass=function(t){var e,n,r;if(this.hasCSSClass(t))return r=function(){var t,n,r,i;for(r=this.attr("class").split(" "),i=[],t=0,n=r.length;t<n;t++)e=r[t],i.push(e);return i}.call(this),n=r.indexOf(t),n>-1&&r.splice(n,1),r.length?this.attr("class",r.join(" ")):this.removeAttr("class"),this._removeCSSClass(t),this.taint()},n.prototype.tagName=function(t){return void 0===t?this._tagName:(this._tagName=t.toLowerCase(),this.isMounted()&&(this.unmount(),this.mount()),this.taint())},n.prototype.unmount=function(){return this._removeDOMEventListeners(),this.isFixed()?(this._removeCSSClass("ce-element"),this._removeCSSClass("ce-element--type-"+this.cssTypeName()),void this._removeCSSClass("ce-element--focused")):(this._domElement.parentNode&&this._domElement.parentNode.removeChild(this._domElement),this._domElement=null,t.Root.get().trigger("unmount",this))},n.prototype._addDOMEventListeners=function(){var t,e,n,r;this._domEventHandlers={dragstart:function(){return function(t){return t.preventDefault()}}(),focus:function(){return function(t){return t.preventDefault()}}(),keydown:function(t){return function(e){return t._onKeyDown(e)}}(this),keyup:function(t){return function(e){return t._onKeyUp(e)}}(this),mousedown:function(t){return function(e){if(0===e.button)return t._onMouseDown(e)}}(this),mousemove:function(t){return function(e){return t._onMouseMove(e)}}(this),mouseover:function(t){return function(e){return t._onMouseOver(e)}}(this),mouseout:function(t){return function(e){return t._onMouseOut(e)}}(this),mouseup:function(t){return function(e){if(0===e.button)return t._onMouseUp(e)}}(this),dragover:function(){return function(t){return t.preventDefault()}}(),drop:function(t){return function(e){return t._onNativeDrop(e)}}(this),paste:function(t){return function(e){return t._onPaste(e)}}(this)},n=this._domEventHandlers,r=[];for(e in n)t=n[e],r.push(this._domElement.addEventListener(e,t));return r},n.prototype._onKeyDown=function(){},n.prototype._onKeyUp=function(){},n.prototype._onMouseDown=function(){if(this.focus)return this.focus(!0)},n.prototype._onMouseMove=function(t){return this._onOver(t)},n.prototype._onMouseOver=function(t){return this._onOver(t)},n.prototype._onMouseOut=function(){var e;if(this._removeCSSClass("ce-element--over"),e=t.Root.get(),e.dragging())return this._removeCSSClass("ce-element--drop"),this._removeCSSClass("ce-element--drop-above"),this._removeCSSClass("ce-element--drop-below"),this._removeCSSClass("ce-element--drop-center"),this._removeCSSClass("ce-element--drop-left"),this._removeCSSClass("ce-element--drop-right"),e._dropTarget=null},n.prototype._onMouseUp=function(){return this._ieMouseDownEchoed=!1},n.prototype._onNativeDrop=function(e){return e.preventDefault(),e.stopPropagation(),t.Root.get().trigger("native-drop",this,e)},n.prototype._onPaste=function(e){return e.preventDefault(),e.stopPropagation(),t.Root.get().trigger("paste",this,e)},n.prototype._onOver=function(){var e,n;if(this._addCSSClass("ce-element--over"),n=t.Root.get(),(e=n.dragging())&&e!==this&&!n._dropTarget&&this.can("drop")&&(this.constructor.droppers[e.type()]||e.constructor.droppers[this.type()]))return this._addCSSClass("ce-element--drop"),n._dropTarget=this},n.prototype._removeDOMEventListeners=function(){var t,e,n,r;n=this._domEventHandlers,r=[];for(e in n)t=n[e],r.push(this._domElement.removeEventListener(e,t));return r},n.prototype._addCSSClass=function(e){if(this.isMounted())return t.addCSSClass(this._domElement,e)},n.prototype._attributesToString=function(){return Object.getOwnPropertyNames(this._attributes).length>0?" "+t.attributesToString(this._attributes):""},n.prototype._removeCSSClass=function(e){if(this.isMounted())return t.removeCSSClass(this._domElement,e)},n.droppers={},n.mergers={},n.placements=["above","below"],n.getDOMElementAttributes=function(t){var e,n,r,i,s;if(!t.hasAttributes())return{};for(n={},s=t.attributes,r=0,i=s.length;r<i;r++)e=s[r],n[e.name.toLowerCase()]=e.value;return n},n._dropVert=function(t,e,n){var r;return t.parent().detach(t),r=e.parent().children.indexOf(e),"below"===n[0]&&(r+=1),e.parent().attach(t,r)},n._dropBoth=function(e,n,r){var i,s,o,a,h,u,l,c;if(e.parent().detach(e),h=n.parent().children.indexOf(n),"below"===r[0]&&"center"===r[1]&&(h+=1),s=t.ALIGNMENT_CLASS_NAMES.left,o=t.ALIGNMENT_CLASS_NAMES.right,e.a){if(e._removeCSSClass(s),e._removeCSSClass(o),e.a["class"]){for(i=[],c=e.a["class"].split(" "),u=0,l=c.length;u<l;u++)(a=c[u])!==s&&a!==o&&i.push(a);i.length?e.a["class"]=i.join(" "):delete e.a["class"]}}else e.removeCSSClass(s),e.removeCSSClass(o);return"left"===r[1]&&(e.a?(e.a["class"]?e.a["class"]+=" "+s:e.a["class"]=s,e._addCSSClass(s)):e.addCSSClass(s)),"right"===r[1]&&(e.a?(e.a["class"]?e.a["class"]+=" "+o:e.a["class"]=o,e._addCSSClass(o)):e.addCSSClass(o)),n.parent().attach(e,h)},n}(t.Node),t.ElementCollection=function(e){function n(e,r){n.__super__.constructor.call(this,e,r),t.NodeCollection.prototype.constructor.call(this)}return a(n,e),n.extend(t.NodeCollection),n.prototype.cssTypeName=function(){return"element-collection"},n.prototype.isMounted=function(){return null!==this._domElement},n.prototype.type=function(){return"ElementCollection"},n.prototype.createDraggingDOMElement=function(){var e,r;if(this.isMounted())return e=n.__super__.createDraggingDOMElement.call(this),r=this._domElement.textContent,r.length>t.HELPER_CHAR_LIMIT&&(r=r.substr(0,t.HELPER_CHAR_LIMIT)),e.innerHTML=r,e},n.prototype.detach=function(e){if(t.NodeCollection.prototype.detach.call(this,e),0===this.children.length&&this.parent())return this.parent().detach(this)},n.prototype.html=function(e){var n,r,i,s;return null==e&&(e=""),i=function(){var n,i,s,o;for(s=this.children,o=[],n=0,i=s.length;n<i;n++)r=s[n],o.push(r.html(e+t.INDENT));return o}.call(this),s=t.LINE_ENDINGS,this.isFixed()?i.join(s):(n=this._attributesToString(),e+"<"+this.tagName()+n+">"+s+i.join(s)+s+e+"</"+this.tagName()+">")},n.prototype.mount=function(){var t,e,r,i,s,o,a,h;this._domElement=document.createElement(this._tagName),o=this._attributes;for(e in o)r=o[e],this._domElement.setAttribute(e,r);for(n.__super__.mount.call(this),a=this.children,h=[],i=0,s=a.length;i<s;i++)t=a[i],h.push(t.mount());return h},n.prototype.unmount=function(){var t,e,r,i;for(i=this.children,e=0,r=i.length;e<r;e++)t=i[e],t.unmount();return n.__super__.unmount.call(this)},n.prototype.blur=void 0,n.prototype.focus=void 0,n}(t.Element),t.ResizableElement=function(e){function n(t,e){n.__super__.constructor.call(this,t,e),this._domSizeInfoElement=null,this._aspectRatio=1}return a(n,e),n.prototype.aspectRatio=function(){return this._aspectRatio},n.prototype.maxSize=function(){var e;return e=parseInt(this.attr("data-ce-max-width")||0),e||(e=t.DEFAULT_MAX_ELEMENT_WIDTH),e=Math.max(e,this.size()[0]),[e,e*this.aspectRatio()]},n.prototype.minSize=function(){var e;return e=parseInt(this.attr("data-ce-min-width")||0),e||(e=t.DEFAULT_MIN_ELEMENT_WIDTH),e=Math.min(e,this.size()[0]),[e,e*this.aspectRatio()]},n.prototype.type=function(){return"ResizableElement"},n.prototype.mount=function(){return n.__super__.mount.call(this),this._domElement.setAttribute("data-ce-size",this._getSizeInfo())},n.prototype.resize=function(e,n,r){if(this.isMounted()&&this.can("resize"))return t.Root.get().startResizing(this,e,n,r,!0)},n.prototype.size=function(t){var e,n,r,i;return t?(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),r=this.minSize(),t[0]=Math.max(t[0],r[0]),t[1]=Math.max(t[1],r[1]),n=this.maxSize(),t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1]),this.attr("width",parseInt(t[0])),this.attr("height",parseInt(t[1])),this.isMounted()?(this._domElement.style.width=t[0]+"px",this._domElement.style.height=t[1]+"px",this._domElement.setAttribute("data-ce-size",this._getSizeInfo())):void 0):(i=parseInt(this.attr("width")||1),e=parseInt(this.attr("height")||1),[i,e])},n.prototype._onMouseDown=function(t){var e;return n.__super__._onMouseDown.call(this,t),e=this._getResizeCorner(t.clientX,t.clientY),e?this.resize(e,t.clientX,t.clientY):(clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),150))},n.prototype._onMouseMove=function(t){var e;if(n.__super__._onMouseMove.call(this),this.can("resize"))return this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right"),e=this._getResizeCorner(t.clientX,t.clientY),e?this._addCSSClass("ce-element--resize-"+e[0]+"-"+e[1]):void 0},n.prototype._onMouseOut=function(){return n.__super__._onMouseOut.call(this),this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right")},n.prototype._onMouseUp=function(){if(n.__super__._onMouseUp.call(this),this._dragTimeout)return clearTimeout(this._dragTimeout)},n.prototype._getResizeCorner=function(e,n){var r,i,s,o,a;return s=this._domElement.getBoundingClientRect(),a=[e-s.left,n-s.top],e=a[0],n=a[1],o=this.size(),i=t.RESIZE_CORNER_SIZE,i=Math.min(i,Math.max(parseInt(o[0]/4),1)),i=Math.min(i,Math.max(parseInt(o[1]/4),1)),r=null,e<i?n<i?r=["top","left"]:n>s.height-i&&(r=["bottom","left"]):e>s.width-i&&(n<i?r=["top","right"]:n>s.height-i&&(r=["bottom","right"])),r},n.prototype._getSizeInfo=function(){var t;return t=this.size(),"w "+t[0]+" \xd7 h "+t[1]},n}(t.Element),t.Region=function(e){function n(t){n.__super__.constructor.call(this),this._domElement=t,this.setContent(t)}return a(n,e),n.prototype.domElement=function(){return this._domElement},n.prototype.isMounted=function(){return!0},n.prototype.type=function(){return"Region"},n.prototype.html=function(e){var n,r;return null==e&&(e=""),r=t.LINE_ENDINGS,function(){var t,r,i,s;for(i=this.children,s=[],t=0,r=i.length;t<r;t++)n=i[t],s.push(n.html(e));return s}.call(this).join(r).trim()},n.prototype.setContent=function(e){var n,r,i,s,o,a,h,u,l,c,p,d,f,m;for(a=e,void 0===e.childNodes&&(l=document.createElement("div"),l.innerHTML=e,a=l),m=this.children.slice(),c=0,d=m.length;c<d;c++)r=m[c],this.detach(r);for(u=t.TagNames.get(),s=function(){var t,e,r,i;for(r=a.childNodes,i=[],t=0,e=r.length;t<e;t++)n=r[t],i.push(n);return i}(),p=0,f=s.length;p<f;p++)i=s[p],1===i.nodeType&&(o=i.getAttribute("data-ce-tag")?u.match(i.getAttribute("data-ce-tag")):u.match(i.tagName),h=o.fromDOMElement(i),a.removeChild(i),h&&this.attach(h));return t.Root.get().trigger("ready",this)},n}(t.NodeCollection),t.Fixture=function(e){function n(e){var r,i,s;n.__super__.constructor.call(this),this._domElement=e,s=t.TagNames.get(),r=this._domElement.getAttribute("data-ce-tag")?s.match(this._domElement.getAttribute("data-ce-tag")):s.match(this._domElement.tagName),i=r.fromDOMElement(this._domElement),this.children=[i],i._parent=this,i.mount(),t.Root.get().trigger("ready",this)}return a(n,e),n.prototype.domElement=function(){return this._domElement},n.prototype.isMounted=function(){return!0},n.prototype.type=function(){return"Fixture"},n.prototype.html=function(e){var n,r;return null==e&&(e=""),r=t.LINE_ENDINGS,function(){var t,r,i,s;for(i=this.children,s=[],t=0,r=i.length;t<r;t++)n=i[t],s.push(n.html(e));return s}.call(this).join(r).trim()},n}(t.NodeCollection),e=function(e){function n(){this._onStopResizing=h(this._onStopResizing,this),this._onResize=h(this._onResize,this),this._onStopDragging=h(this._onStopDragging,this),this._onDrag=h(this._onDrag,this),n.__super__.constructor.call(this),this._focused=null,this._dragging=null,this._dropTarget=null,this._draggingDOMElement=null,this._resizing=null,this._resizingInit=null}return a(n,e),n.prototype.dragging=function(){return this._dragging},n.prototype.dropTarget=function(){return this._dropTarget},n.prototype.focused=function(){return this._focused},n.prototype.resizing=function(){return this._resizing},n.prototype.type=function(){return"Root"},n.prototype.cancelDragging=function(){if(this._dragging)return document.body.removeChild(this._draggingDOMElement),document.removeEventListener("mousemove",this._onDrag),document.removeEventListener("mouseup",this._onStopDragging),this._dragging._removeCSSClass("ce-element--dragging"),this._dragging=null,this._dropTarget=null,t.removeCSSClass(document.body,"ce--dragging")},n.prototype.startDragging=function(e,n,r){if(!this._dragging)return this._dragging=e,this._dragging._addCSSClass("ce-element--dragging"),this._draggingDOMElement=this._dragging.createDraggingDOMElement(),document.body.appendChild(this._draggingDOMElement),this._draggingDOMElement.style.left=n+"px",this._draggingDOMElement.style.top=r+"px",document.addEventListener("mousemove",this._onDrag),document.addEventListener("mouseup",this._onStopDragging),t.addCSSClass(document.body,"ce--dragging")},n.prototype._getDropPlacement=function(e,n){var r,i,s,o;return this._dropTarget?(i=this._dropTarget.domElement().getBoundingClientRect(),o=[e-i.left,n-i.top],e=o[0],n=o[1],r="center",e<t.DROP_EDGE_SIZE?r="left":e>i.width-t.DROP_EDGE_SIZE&&(r="right"),s="above",n>i.height/2&&(s="below"),[s,r]):null},n.prototype._onDrag=function(t){var e,n,r;if(ContentSelect.Range.unselectAll(),this._draggingDOMElement.style.left=t.pageX+"px",this._draggingDOMElement.style.top=t.pageY+"px",this._dropTarget&&(e=this._getDropPlacement(t.clientX,t.clientY),this._dropTarget._removeCSSClass("ce-element--drop-above"),this._dropTarget._removeCSSClass("ce-element--drop-below"),this._dropTarget._removeCSSClass("ce-element--drop-center"),this._dropTarget._removeCSSClass("ce-element--drop-left"),this._dropTarget._removeCSSClass("ce-element--drop-right"),n=e[0],s.call(this._dragging.constructor.placements,n)>=0&&this._dropTarget._addCSSClass("ce-element--drop-"+e[0]),r=e[1],s.call(this._dragging.constructor.placements,r)>=0))return this._dropTarget._addCSSClass("ce-element--drop-"+e[1])},n.prototype._onStopDragging=function(t){var e;return e=this._getDropPlacement(t.clientX,t.clientY),this._dragging.drop(this._dropTarget,e),this.cancelDragging()},n.prototype.startResizing=function(e,n,r,i,s){var o,a;if(!this._resizing)return this._resizing=e,this._resizingInit={corner:n,fixed:s,origin:[r,i],size:e.size()},this._resizing._addCSSClass("ce-element--resizing"),a=this._resizing.parent().domElement(),o=document.createElement("div"),o.setAttribute("class","ce-measure"),a.appendChild(o),this._resizingParentWidth=o.getBoundingClientRect().width,a.removeChild(o),document.addEventListener("mousemove",this._onResize),document.addEventListener("mouseup",this._onStopResizing),t.addCSSClass(document.body,"ce--resizing")},n.prototype._onResize=function(t){var e,n,r,i;return ContentSelect.Range.unselectAll(),r=this._resizingInit.origin[0]-t.clientX,"right"===this._resizingInit.corner[1]&&(r=-r),n=this._resizingInit.size[0]+r,n=Math.min(n,this._resizingParentWidth),this._resizingInit.fixed?e=n*this._resizing.aspectRatio():(i=this._resizingInit.origin[1]-t.clientY,"bottom"===this._resizingInit.corner[0]&&(i=-i),e=this._resizingInit.size[1]+i),this._resizing.size([n,e])},n.prototype._onStopResizing=function(){return document.removeEventListener("mousemove",this._onResize),document.removeEventListener("mouseup",this._onStopResizing),this._resizing._removeCSSClass("ce-element--resizing"),this._resizing=null,this._resizingInit=null,this._resizingParentWidth=null,t.removeCSSClass(document.body,"ce--resizing")},n}(t.Node),t.Root=function(){function t(){}var n;return n=null,t.get=function(){return null!=n?n:n=new e},t}(),t.Static=function(e){function n(t,e,r){n.__super__.constructor.call(this,t,e),this._content=r}return a(n,e),n.prototype.cssTypeName=function(){return"static"},n.prototype.type=function(){return"Static"},n.prototype.typeName=function(){return"Static"},n.prototype.createDraggingDOMElement=function(){var e,r;if(this.isMounted())return e=n.__super__.createDraggingDOMElement.call(this),r=this._domElement.textContent,r.length>t.HELPER_CHAR_LIMIT&&(r=r.substr(0,t.HELPER_CHAR_LIMIT)),e.innerHTML=r,e},n.prototype.html=function(t){return null==t&&(t=""),HTMLString.Tag.SELF_CLOSING[this._tagName]?t+"<"+this._tagName+this._attributesToString()+">":t+"<"+this._tagName+this._attributesToString()+">"+this._content+t+"</"+this._tagName+">"},n.prototype.mount=function(){var t,e,r;this._domElement=document.createElement(this._tagName),r=this._attributes;for(t in r)e=r[t],this._domElement.setAttribute(t,e);return this._domElement.innerHTML=this._content,n.__super__.mount.call(this)},n.prototype.blur=void 0,n.prototype.focus=void 0,n.prototype._onMouseDown=function(t){if(n.__super__._onMouseDown.call(this,t),void 0!==this.attr("data-ce-moveable"))return clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),150)},n.prototype._onMouseOver=function(t){return n.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},n.prototype._onMouseUp=function(t){if(n.__super__._onMouseUp.call(this,t),this._dragTimeout)return clearTimeout(this._dragTimeout)},n.droppers={Static:t.Element._dropVert},n.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML)},n}(t.Element),t.TagNames.get().register(t.Static,"static"),t.Text=function(e){function n(e,r,i){n.__super__.constructor.call(this,e,r),i instanceof HTMLString.String?this.content=i:t.TRIM_WHITESPACE?this.content=new HTMLString.String(i).trim():this.content=new HTMLString.String(i,!0)}return a(n,e),n.prototype.cssTypeName=function(){return"text"},n.prototype.type=function(){return"Text"},n.prototype.typeName=function(){return"Text"},n.prototype.blur=function(){return this.isMounted()&&this._syncContent(),this.content.isWhitespace()&&this.can("remove")?this.parent()&&this.parent().detach(this):this.isMounted()&&(document.documentMode||/Edge/.test(navigator.userAgent)||this._domElement.blur(),this._domElement.removeAttribute("contenteditable")),n.__super__.blur.call(this)},n.prototype.createDraggingDOMElement=function(){var e,r;if(this.isMounted())return e=n.__super__.createDraggingDOMElement.call(this),r=HTMLString.String.encode(this._domElement.textContent),r.length>t.HELPER_CHAR_LIMIT&&(r=r.substr(0,t.HELPER_CHAR_LIMIT)),e.innerHTML=r,e},n.prototype.drag=function(t,e){return this.storeState(),this._domElement.removeAttribute("contenteditable"),n.__super__.drag.call(this,t,e)},n.prototype.drop=function(t,e){return n.__super__.drop.call(this,t,e),this.restoreState()},n.prototype.focus=function(t){return this.isMounted()&&this._domElement.setAttribute("contenteditable",""),n.__super__.focus.call(this,t)},n.prototype.html=function(e){var n,r,i;return null==e&&(e=""),(!this._lastCached||this._lastCached<this._modified)&&(r=t.TRIM_WHITESPACE?this.content.copy().trim():this.content.copy(),r.optimize(),this._lastCached=Date.now(),this._cached=r.html()),i=t.LINE_ENDINGS,n=this._attributesToString(),e+"<"+this._tagName+n+">"+i+e+t.INDENT+this._cached+i+e+"</"+this._tagName+">"},n.prototype.mount=function(){var t,e,r;this._domElement=document.createElement(this._tagName),r=this._attributes;for(t in r)e=r[t],this._domElement.setAttribute(t,e);return this.updateInnerHTML(),n.__super__.mount.call(this)},n.prototype.restoreState=function(){if(this._savedSelection)return this.isMounted()&&this.isFocused()?(this._domElement.setAttribute("contenteditable",""),this._addCSSClass("ce-element--focused"),document.activeElement!==this.domElement()&&this.domElement().focus(),this._savedSelection.select(this._domElement),this._savedSelection=void 0):void(this._savedSelection=void 0)},n.prototype.selection=function(t){return void 0===t?this.isMounted()?ContentSelect.Range.query(this._domElement):new ContentSelect.Range(0,0):t.select(this._domElement)},n.prototype.storeState=function(){if(this.isMounted()&&this.isFocused())return this._savedSelection=ContentSelect.Range.query(this._domElement)},n.prototype.unmount=function(){return this._domElement.removeAttribute("contenteditable"),n.__super__.unmount.call(this)},n.prototype.updateInnerHTML=function(){return this._domElement.innerHTML=this.content.html(),ContentSelect.Range.prepareElement(this._domElement),this._flagIfEmpty()},n.prototype._onKeyDown=function(t){switch(t.keyCode){case 40:return this._keyDown(t);case 37:return this._keyLeft(t);case 39:return this._keyRight(t);case 38:return this._keyUp(t);case 9:return this._keyTab(t);case 8:return this._keyBack(t);case 46:return this._keyDelete(t);case 13:return this._keyReturn(t)}},n.prototype._onKeyUp=function(t){return n.__super__._onKeyUp.call(this,t),this._syncContent()},n.prototype._onMouseDown=function(e){if(n.__super__._onMouseDown.call(this,e),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(t){return function(){return t.drag(e.pageX,e.pageY)}}(this),t.DRAG_HOLD_DURATION),0===this.content.length()&&t.Root.get().focused()===this)return e.preventDefault(),document.activeElement!==this._domElement&&this._domElement.focus(),new ContentSelect.Range(0,0).select(this._domElement)},n.prototype._onMouseMove=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),n.__super__._onMouseMove.call(this,t)},n.prototype._onMouseOut=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),n.__super__._onMouseOut.call(this,t)},n.prototype._onMouseUp=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),n.__super__._onMouseUp.call(this,t)},n.prototype._keyBack=function(t){var e,n;if(n=ContentSelect.Range.query(this._domElement),0===n.get()[0]&&n.isCollapsed())return t.preventDefault(),e=this.previousContent(),this._syncContent(),e?e.merge(this):void 0},n.prototype._keyDelete=function(t){var e,n;if(n=ContentSelect.Range.query(this._domElement),this._atEnd(n)&&n.isCollapsed())return t.preventDefault(),e=this.nextContent(),e?this.merge(e):void 0},n.prototype._keyDown=function(t){return this._keyRight(t)},n.prototype._keyLeft=function(e){var n,r;if(r=ContentSelect.Range.query(this._domElement),0===r.get()[0]&&r.isCollapsed())return e.preventDefault(),n=this.previousContent(),n?(n.focus(),r=new ContentSelect.Range(n.content.length(),n.content.length()),r.select(n.domElement())):t.Root.get().trigger("previous-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()}))},n.prototype._keyReturn=function(e){var n,r,i,s,o,a;if(e.preventDefault(),!(this.content.isWhitespace()&&!e.shiftKey^t.PREFER_LINE_BREAKS)){if(s=ContentSelect.Range.query(this._domElement),a=this.content.substring(0,s.get()[0]),o=this.content.substring(s.get()[1]),e.shiftKey^t.PREFER_LINE_BREAKS)return r=s.get()[0],i="<br>",this.content.length()===r&&(0!==this.content.length()&&this.content.characters[r-1].isTag("br")||(i="<br><br>")),this.content=this.content.insert(r,new HTMLString.String(i,!0),!0),this.updateInnerHTML(),r+=1,s=new ContentSelect.Range(r,r),s.select(this.domElement()),void this.taint();if(this.can("spawn"))return this.content=a.trim(),this.updateInnerHTML(),n=new this.constructor("p",{},o.trim()),this.parent().attach(n,this.parent().children.indexOf(this)+1),a.length()?(n.focus(),s=new ContentSelect.Range(0,0),s.select(n.domElement())):(s=new ContentSelect.Range(0,a.length()),s.select(this._domElement)),this.taint()}},n.prototype._keyRight=function(e){var n,r;if(r=ContentSelect.Range.query(this._domElement),this._atEnd(r)&&r.isCollapsed())return e.preventDefault(),n=this.nextContent(),n?(n.focus(),r=new ContentSelect.Range(0,0),r.select(n.domElement())):t.Root.get().trigger("next-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()}))},n.prototype._keyTab=function(e){if(e.preventDefault(),this.isFixed())return e.shiftKey?t.Root.get().trigger("previous-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()})):t.Root.get().trigger("next-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()}))},n.prototype._keyUp=function(t){return this._keyLeft(t)},n.prototype._atEnd=function(t){return t.get()[0]>=this.content.length()},n.prototype._flagIfEmpty=function(){return 0===this.content.length()?this._addCSSClass("ce-element--empty"):this._removeCSSClass("ce-element--empty")},n.prototype._syncContent=function(){var t,e;return e=this.content.html(),this.content=new HTMLString.String(this._domElement.innerHTML,this.content.preserveWhitespace()),t=this.content.html(),e!==t&&this.taint(),this._flagIfEmpty()},n.droppers={Static:t.Element._dropVert,Text:t.Element._dropVert},n.mergers={Text:function(t,e){var n;return n=e.content.length(),t.content.length()&&(e.content=e.content.concat(t.content)),e.isMounted()&&e.updateInnerHTML(),e.focus(),new ContentSelect.Range(n,n).select(e._domElement),t.parent()&&t.parent().detach(t),e.taint()}},n.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML.replace(/^\s+|\s+$/g,""))},n}(t.Element),t.TagNames.get().register(t.Text,"address","blockquote","h1","h2","h3","h4","h5","h6","p"),t.PreText=function(e){function n(e,n,r){r instanceof HTMLString.String?this.content=r:this.content=new HTMLString.String(r,!0),t.Element.call(this,e,n)}return a(n,e),n.TAB_INDENT="    ",n.prototype.cssTypeName=function(){return"pre-text"},n.prototype.type=function(){return"PreText"},n.prototype.typeName=function(){return"Preformatted"},n.prototype.blur=function(){return this.isMounted()&&(this._domElement.innerHTML=this.content.html()),n.__super__.blur.call(this)},n.prototype.html=function(t){var e;return null==t&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(e=this.content.copy(),e.optimize(),this._lastCached=Date.now(),this._cached=e.html()),t+"<"+this._tagName+this._attributesToString()+">"+this._cached+"</"+this._tagName+">"},n.prototype.updateInnerHTML=function(){var t;return t=this.content.html(),this._domElement.innerHTML=t,this._ensureEndZWS(),ContentSelect.Range.prepareElement(this._domElement),this._flagIfEmpty()},n.prototype._keyBack=function(t){var e;return e=ContentSelect.Range.query(this._domElement),e.get()[0]<=this.content.length()?n.__super__._keyBack.call(this,t):(e.set(this.content.length(),this.content.length()),e.select(this._domElement))},n.prototype._keyReturn=function(t){var e,n,r,i;return t.preventDefault(),n=ContentSelect.Range.query(this._domElement),e=n.get()[0]+1,0===n.get()[0]&&n.isCollapsed()?this.content=new HTMLString.String("\n",!0).concat(this.content):this._atEnd(n)&&n.isCollapsed()?this.content=this.content.concat(new HTMLString.String("\n",!0)):0===n.get()[0]&&n.get()[1]===this.content.length()?(this.content=new HTMLString.String("\n",!0),e=0):(i=this.content.substring(0,n.get()[0]),r=this.content.substring(n.get()[1]),this.content=i.concat(new HTMLString.String("\n",!0),r)),this.updateInnerHTML(),n.set(e,e),n.select(this._domElement),this.taint()},n.prototype._keyTab=function(e){var n,r,i,s,o,a,h,u,l,c,p,d,f,m,g,_,y,v,E,T,S,C,b,M,N,w;for(e.preventDefault(),n=this.content.length(),l=t.PreText.TAB_INDENT,u=l.length,f=this.content.split("\n"),m=this.selection().get(),m[0]=Math.min(m[0],n),m[1]=Math.min(m[1],n),i=0,y=-1,s=-1,a=T=0,M=f.length;T<M&&(p=f[a],d=p.length()+1,m[0]<i+d&&-1===y&&(y=a),m[1]<i+d&&-1===s&&(s=a),!(y>-1&&s>-1));a=++T)i+=d;if(y===s)u-=(m[0]-i)%u,h=new HTMLString.String(Array(u+1).join(" "),!0),E=f[y].substring(0,m[0]-i),v=f[y].substring(m[1]-i),f[y]=E.concat(h,v),_=u;else if(e.shiftKey){for(o=0,a=S=y;y<=s?S<=s:S>=s;a=y<=s?++S:--S){for(w=f[a].characters.slice(),c=C=0,N=w.length;C<N&&(r=w[c],!(c>u-1))&&r.isWhitespace();c=++C)f[a].characters.shift();a===y&&(o=c)}_=Math.max(-u,-o)}else{for(h=new HTMLString.String(l,!0),a=b=y;y<=s?b<=s:b>=s;a=y<=s?++b:--b)f[a]=h.concat(f[a]);_=u}return this.content=HTMLString.String.join(new HTMLString.String("\n",!0),f),this.updateInnerHTML(),g=this.content.length()-n,new ContentSelect.Range(m[0]+_,m[1]+g).select(this._domElement)},n.prototype._syncContent=function(){var t,e;return this._ensureEndZWS(),e=this.content.html(),this.content=new HTMLString.String(this._domElement.innerHTML.replace(/\u200B$/g,""),this.content.preserveWhitespace()),t=this.content.html(),e!==t&&this.taint(),this._flagIfEmpty()},n.prototype._ensureEndZWS=function(){var t,e;if(this._domElement.lastChild&&(t=this._domElement.innerHTML,!("\u200b"===t[t.length-1]&&t.indexOf("\u200b")<t.length-1)))return e=function(e){return function(){return t.indexOf("\u200b")>-1&&(e._domElement.innerHTML=t.replace(/\u200B/g,"")),e._domElement.lastChild.textContent+="\u200b"}}(this),this._savedSelection?e():(this.storeState(),e(),this.restoreState())},n.droppers={PreText:t.Element._dropVert,Static:t.Element._dropVert,Text:t.Element._dropVert},n.mergers={},n.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML)},n}(t.Text),t.TagNames.get().register(t.PreText,"pre"),t.Image=function(e){function n(t,e){var r;n.__super__.constructor.call(this,"img",t),this.a=e||null,r=this.size(),this._aspectRatio=r[1]/r[0]}return a(n,e),n.prototype.cssTypeName=function(){return"image"},n.prototype.type=function(){return"Image"},n.prototype.typeName=function(){return"Image"},n.prototype.createDraggingDOMElement=function(){var t;if(this.isMounted())return t=n.__super__.createDraggingDOMElement.call(this),t.style.backgroundImage="url('"+this._attributes.src+"')",t},n.prototype.html=function(e){var n,r,i;return null==e&&(e=""),r=e+"<img"+this._attributesToString()+">",this.a?(i=t.LINE_ENDINGS,n=t.attributesToString(this.a),n+=' data-ce-tag="img"',e+"<a "+n+">"+i+t.INDENT+r+i+e+"</a>"):r},n.prototype.mount=function(){var t,e;return this._domElement=document.createElement("div"),t="",this.a&&this.a["class"]&&(t+=" "+this.a["class"]),this._attributes["class"]&&(t+=" "+this._attributes["class"]),this._domElement.setAttribute("class",t),e=this._attributes.style?this._attributes.style:"",e+="background-image:url('"+this._attributes.src+"');",this._attributes.width&&(e+="width:"+this._attributes.width+"px;"),this._attributes.height&&(e+="height:"+this._attributes.height+"px;"),this._domElement.setAttribute("style",e),n.__super__.mount.call(this)},n.prototype.unmount=function(){var t,e;return this.isFixed()&&(e=document.createElement("div"),e.innerHTML=this.html(),t=e.querySelector("a, img"),this._domElement.parentNode.replaceChild(t,this._domElement),this._domElement=t),n.__super__.unmount.call(this)},n.droppers={Image:t.Element._dropBoth,PreText:t.Element._dropBoth,Static:t.Element._dropBoth,Text:t.Element._dropBoth},n.placements=["above","below","left","right","center"],n.fromDOMElement=function(t){var e,n,r,i,s,o,a,h,u;if(e=null,"a"===t.tagName.toLowerCase()){for(e=this.getDOMElementAttributes(t),s=function(){var e,n,i,s;for(i=t.childNodes,s=[],e=0,n=i.length;e<n;e++)r=i[e],s.push(r);return s}(),h=0,u=s.length;h<u;h++)if(i=s[h],1===i.nodeType&&"img"===i.tagName.toLowerCase()){t=i;break}"a"===t.tagName.toLowerCase()&&(t=document.createElement("img"))}return n=this.getDOMElementAttributes(t),a=n.width,o=n.height,void 0===n.width&&(a=void 0===n.height?t.naturalWidth:t.clientWidth),void 0===n.height&&(o=void 0===n.width?t.naturalHeight:t.clientHeight),n.width=a,n.height=o,new this(n,e)},n}(t.ResizableElement),t.TagNames.get().register(t.Image,"img"),t.ImageFixture=function(e){function n(t,e,r){n.__super__.constructor.call(this,t,e),this._src=r}return a(n,e),n.prototype.cssTypeName=function(){return"image-fixture"},n.prototype.type=function(){return"ImageFixture"},n.prototype.typeName=function(){return"ImageFixture"},n.prototype.html=function(e){var n,r,i,s;return null==e&&(e=""),s=t.LINE_ENDINGS,r=this._attributesToString(),n="",void 0!==this._attributes.alt&&(n='alt="'+this._attributes.alt+'"'),i=e+'<img src="'+this.src()+'"'+n+">",e+"<"+this.tagName()+" "+r+">"+s+t.INDENT+i+s+e+"</"+this.tagName()+">"},n.prototype.mount=function(){var t,e,r,i,s;this._domElement=document.createElement(this.tagName()),s=this._attributes;for(e in s)i=s[e],
"alt"!==e&&"style"!==e&&this._domElement.setAttribute(e,i);return t="",this.a&&this.a["class"]&&(t+=" "+this.a["class"]),this._attributes["class"]&&(t+=" "+this._attributes["class"]),this._domElement.setAttribute("class",t),r=this._attributes.style?this._attributes.style:"",r=r.replace(/background-image:.+?(;|$)/i,""),r=[r.trim(),"background-image:url('"+this.src()+"');"].join(" "),this._domElement.setAttribute("style",r.trim()),n.__super__.mount.call(this)},n.prototype.src=function(t){return void 0===t?this._src:(this._src=t.toLowerCase(),this.isMounted()&&(this.unmount(),this.mount()),this.taint())},n.prototype.unmount=function(){var t,e;return this.isFixed()?(e=document.createElement("div"),e.innerHTML=this.html(),t=e.firstElementChild,this._domElement.parentNode.replaceChild(t,this._domElement),this._domElement=t,this.parent()._domElement=this._domElement):n.__super__.unmount.call(this)},n.prototype._attributesToString=function(){var e,n,r,i,s;this._attributes.style?(r=this._attributes.style?this._attributes.style:"",r=r.replace(/background-image:.+?(;|$)/i,""),r=[r.trim(),"background-image:url('"+this.src()+"');"].join(" "),this._attributes.style=r.trim()):this._attributes.style="background-image:url('"+this.src()+"');",e={},s=this._attributes;for(n in s)i=s[n],"alt"!==n&&(e[n]=i);return" "+t.attributesToString(e)},n.droppers={ImageFixture:t.Element._dropVert,Image:t.Element._dropVert,PreText:t.Element._dropVert,Text:t.Element._dropVert},n.fromDOMElement=function(t){var e,n,r,i,s,o,a,h;for(t.tagName,n=this.getDOMElementAttributes(t),o="",e="",s=function(){var e,n,i,s;for(i=t.childNodes,s=[],e=0,n=i.length;e<n;e++)r=i[e],s.push(r);return s}(),a=0,h=s.length;a<h;a++)if(i=s[a],1===i.nodeType&&"img"===i.tagName.toLowerCase()){o=i.getAttribute("src")||"",e=i.getAttribute("alt")||"";break}return n=this.getDOMElementAttributes(t),n.alt=e,new this(t.tagName,n,o)},n}(t.Element),t.TagNames.get().register(t.ImageFixture,"img-fixture"),t.Video=function(e){function n(t,e,r){var i;null==r&&(r=[]),n.__super__.constructor.call(this,t,e),this.sources=r,i=this.size(),this._aspectRatio=i[1]/i[0]}return a(n,e),n.prototype.cssTypeName=function(){return"video"},n.prototype.type=function(){return"Video"},n.prototype.typeName=function(){return"Video"},n.prototype._title=function(){var t;return t="",this.attr("src")?t=this.attr("src"):this.sources.length&&(t=this.sources[0].src),t||(t="No video source set"),t.length>80&&(t=t.substr(0,80)+"..."),t},n.prototype.createDraggingDOMElement=function(){var t;if(this.isMounted())return t=n.__super__.createDraggingDOMElement.call(this),t.innerHTML=this._title(),t},n.prototype.html=function(e){var n,r,i,s,o,a,h;if(null==e&&(e=""),r=t.LINE_ENDINGS,"video"===this.tagName()){for(s=[],h=this.sources,o=0,a=h.length;o<a;o++)i=h[o],n=t.attributesToString(i),s.push(""+e+t.INDENT+"<source "+n+">");return e+"<video"+this._attributesToString()+">"+r+s.join(r)+r+e+"</video>"}return e+"<"+this._tagName+this._attributesToString()+"></"+this._tagName+">"},n.prototype.mount=function(){var t;return this._domElement=document.createElement("div"),this.a&&this.a["class"]?this._domElement.setAttribute("class",this.a["class"]):this._attributes["class"]&&this._domElement.setAttribute("class",this._attributes["class"]),t=this._attributes.style?this._attributes.style:"",this._attributes.width&&(t+="width:"+this._attributes.width+"px;"),this._attributes.height&&(t+="height:"+this._attributes.height+"px;"),this._domElement.setAttribute("style",t),this._domElement.setAttribute("data-ce-title",this._title()),n.__super__.mount.call(this)},n.prototype.unmount=function(){var t,e;return this.isFixed()&&(e=document.createElement("div"),e.innerHTML=this.html(),t=e.querySelector("iframe"),this._domElement.parentNode.replaceChild(t,this._domElement),this._domElement=t),n.__super__.unmount.call(this)},n.droppers={Image:t.Element._dropBoth,PreText:t.Element._dropBoth,Static:t.Element._dropBoth,Text:t.Element._dropBoth,Video:t.Element._dropBoth},n.placements=["above","below","left","right","center"],n.fromDOMElement=function(t){var e,n,r,i,s,o;for(r=function(){var n,r,i,s;for(i=t.childNodes,s=[],n=0,r=i.length;n<r;n++)e=i[n],s.push(e);return s}(),i=[],s=0,o=r.length;s<o;s++)n=r[s],1===n.nodeType&&"source"===n.tagName.toLowerCase()&&i.push(this.getDOMElementAttributes(n));return new this(t.tagName,this.getDOMElementAttributes(t),i)},n}(t.ResizableElement),t.TagNames.get().register(t.Video,"iframe","video"),t.List=function(e){function n(t,e){n.__super__.constructor.call(this,t,e)}return a(n,e),n.prototype.cssTypeName=function(){return"list"},n.prototype.type=function(){return"List"},n.prototype.typeName=function(){return"List"},n.prototype._onMouseOver=function(t){if("ListItem"!==this.parent().type())return n.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},n.droppers={Image:t.Element._dropBoth,ImageFixture:t.Element._dropVert,List:t.Element._dropVert,PreText:t.Element._dropVert,Static:t.Element._dropVert,Text:t.Element._dropVert,Video:t.Element._dropBoth},n.fromDOMElement=function(e){var n,r,i,s,o,a;for(s=new this(e.tagName,this.getDOMElementAttributes(e)),i=function(){var t,r,i,s;for(i=e.childNodes,s=[],t=0,r=i.length;t<r;t++)n=i[t],s.push(n);return s}(),o=0,a=i.length;o<a;o++)r=i[o],1===r.nodeType&&"li"===r.tagName.toLowerCase()&&s.attach(t.ListItem.fromDOMElement(r));return 0===s.children.length?null:s},n}(t.ElementCollection),t.TagNames.get().register(t.List,"ol","ul"),t.ListItem=function(e){function n(t){n.__super__.constructor.call(this,"li",t),this._behaviours.indent=!0}return a(n,e),n.prototype.cssTypeName=function(){return"list-item"},n.prototype.list=function(){return 2===this.children.length?this.children[1]:null},n.prototype.listItemText=function(){return this.children.length>0?this.children[0]:null},n.prototype.type=function(){return"ListItem"},n.prototype.html=function(e){var n;return null==e&&(e=""),n=[e+"<li"+this._attributesToString()+">"],this.listItemText()&&n.push(this.listItemText().html(e+t.INDENT)),this.list()&&n.push(this.list().html(e+t.INDENT)),n.push(e+"</li>"),n.join(t.LINE_ENDINGS)},n.prototype.indent=function(){var e;if(this.can("indent")&&0!==this.parent().children.indexOf(this))return e=this.previousSibling(),e.list()||e.attach(new t.List(e.parent().tagName())),this.listItemText().storeState(),this.parent().detach(this),e.list().attach(this),this.listItemText().restoreState()},n.prototype.remove=function(){var t,e,n,r,i,s;if(this.parent()){if(n=this.parent().children.indexOf(this),this.list())for(s=this.list().children.slice(),e=r=0,i=s.length;r<i;e=++r)t=s[e],t.parent().detach(t),this.parent().attach(t,e+n);return this.parent().detach(this)}},n.prototype.unindent=function(){var e,n,r,i,s,o,a,h,u,l,c,p,d,f,m,g,_,y,v,E,T;if(this.can("indent")){if(o=this.parent(),n=o.parent(),l=o.children.slice(o.children.indexOf(this)+1,o.children.length),"ListItem"===n.type()){for(this.listItemText().storeState(),o.detach(this),n.parent().attach(this,n.parent().children.indexOf(n)+1),l.length&&!this.list()&&this.attach(new t.List(o.tagName())),p=0,g=l.length;p<g;p++)u=l[p],u.parent().detach(u),this.list().attach(u);return this.listItemText().restoreState()}if(c=new t.Text("p",this.attr("class")?{"class":this.attr("class")}:{},this.listItemText().content),h=null,this.listItemText().isFocused()&&(h=ContentSelect.Range.query(this.listItemText().domElement())),a=n.children.indexOf(o),0===(i=o.children.indexOf(this))){if(s=null,1===o.children.length?(this.list()&&(s=new t.List(o.tagName())),n.detach(o)):o.detach(this),n.attach(c,a),s&&n.attach(s,a+1),this.list())for(E=this.list().children.slice(),r=d=0,_=E.length;d<_;r=++d)e=E[r],e.parent().detach(e),s?s.attach(e):o.attach(e,r)}else if(i===o.children.length-1)o.detach(this),n.attach(c,a+1),this.list()&&n.attach(this.list(),a+2);else{if(o.detach(this),n.attach(c,a+1),s=new t.List(o.tagName()),n.attach(s,a+2),this.list())for(T=this.list().children.slice(),f=0,y=T.length;f<y;f++)e=T[f],e.parent().detach(e),s.attach(e);for(m=0,v=l.length;m<v;m++)u=l[m],u.parent().detach(u),s.attach(u)}return h?(c.focus(),h.select(c.domElement())):void 0}},n.prototype._onMouseOver=function(t){return n.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},n.prototype._addDOMEventListeners=function(){},n.prototype._removeDOMEventListners=function(){},n.fromDOMElement=function(e){var n,r,i,s,o,a,h,u,l,c;for(o=new this(this.getDOMElementAttributes(e)),r="",i=null,l=e.childNodes,h=0,u=l.length;h<u;h++)n=l[h],1===n.nodeType?"ul"===(c=n.tagName.toLowerCase())||"ol"===c||"li"===c?i||(i=n):r+=n.outerHTML:r+=HTMLString.String.encode(n.textContent);return r=r.replace(/^\s+|\s+$/g,""),a=new t.ListItemText(r),o.attach(a),i&&(s=t.List.fromDOMElement(i),o.attach(s)),o},n}(t.ElementCollection),t.ListItemText=function(e){function n(t){n.__super__.constructor.call(this,"div",{},t)}return a(n,e),n.prototype.cssTypeName=function(){return"list-item-text"},n.prototype.type=function(){return"ListItemText"},n.prototype.typeName=function(){return"List item"},n.prototype.blur=function(){return this.content.isWhitespace()&&this.can("remove")?this.parent().remove():this.isMounted()&&(this._domElement.blur(),this._domElement.removeAttribute("contenteditable")),t.Element.prototype.blur.call(this)},n.prototype.can=function(t,e){if(e)throw new Error("Cannot set behaviour for ListItemText");return this.parent().can(t)},n.prototype.html=function(e){var n;return null==e&&(e=""),(!this._lastCached||this._lastCached<this._modified)&&(n=t.TRIM_WHITESPACE?this.content.copy().trim():this.content.copy(),n.optimize(),this._lastCached=Date.now(),this._cached=n.html()),""+e+this._cached},n.prototype._onMouseDown=function(e){var n;return t.Element.prototype._onMouseDown.call(this,e),n=function(r){return function(){var i;return t.Root.get().dragging()===r?(t.Root.get().cancelDragging(),i=r.closest(function(t){return"Region"===t.parent().type()}),i.drag(e.pageX,e.pageY)):(r.drag(e.pageX,e.pageY),r._dragTimeout=setTimeout(n,2*t.DRAG_HOLD_DURATION))}}(this),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(n,t.DRAG_HOLD_DURATION)},n.prototype._onMouseMove=function(e){return this._dragTimeout&&clearTimeout(this._dragTimeout),t.Element.prototype._onMouseMove.call(this,e)},n.prototype._onMouseUp=function(e){return this._dragTimeout&&clearTimeout(this._dragTimeout),t.Element.prototype._onMouseUp.call(this,e)},n.prototype._keyTab=function(t){return t.preventDefault(),t.shiftKey?this.parent().unindent():this.parent().indent()},n.prototype._keyReturn=function(e){var n,r,i,s,o,a;return e.preventDefault(),this.content.isWhitespace()?void this.parent().unindent():this.can("spawn")?(ContentSelect.Range.query(this._domElement),s=ContentSelect.Range.query(this._domElement),a=this.content.substring(0,s.get()[0]),o=this.content.substring(s.get()[1]),a.length()+o.length()===0?void this.parent().unindent():(this.content=a.trim(),this.updateInnerHTML(),n=this.parent().parent(),i=new t.ListItem(this.attr("class")?{"class":this.attr("class")}:{}),n.attach(i,n.children.indexOf(this.parent())+1),i.attach(new t.ListItemText(o.trim())),r=this.parent().list(),r&&(this.parent().detach(r),i.attach(r)),a.length()?(i.listItemText().focus(),s=new ContentSelect.Range(0,0),s.select(i.listItemText().domElement())):(s=new ContentSelect.Range(0,a.length()),s.select(this._domElement)),this.taint())):void 0},n.droppers={ListItemText:function(e,n,r){var i,s,o,a;return i=e.parent(),a=n.parent(),i.remove(),i.detach(e),o=new t.ListItem(i._attributes),o.attach(e),a.list()&&"below"===r[0]?void a.list().attach(o,0):(s=a.parent().children.indexOf(a),"below"===r[0]&&(s+=1),a.parent().attach(o,s))},Text:function(e,n,r){var i,s,o,a,h;if("Text"===e.type()){if(a=n.parent(),e.parent().detach(e),i=e.attr("class"),o=new t.ListItem(i?{"class":i}:{}),o.attach(new t.ListItemText(e.content)),a.list()&&"below"===r[0])return void a.list().attach(o,0);if(s=a.parent().children.indexOf(a),"below"===r[0]&&(s+=1),a.parent().attach(o,s),o.listItemText().focus(),e._savedSelection)return e._savedSelection.select(o.listItemText().domElement())}else if(i=e.attr("class"),h=new t.Text("p",i?{"class":i}:{},e.content),e.parent().remove(),s=n.parent().children.indexOf(n),"below"===r[0]&&(s+=1),n.parent().attach(h,s),h.focus(),e._savedSelection)return e._savedSelection.select(h.domElement())}},n.mergers={ListItemText:function(t,e){var n;return n=e.content.length(),t.content.length()&&(e.content=e.content.concat(t.content)),e.isMounted()&&(e._domElement.innerHTML=e.content.html()),e.focus(),new ContentSelect.Range(n,n).select(e._domElement),"Text"===t.type()?t.parent()&&t.parent().detach(t):t.parent().remove(),e.taint()}},n}(t.Text),r=t.ListItemText.mergers,r.Text=r.ListItemText,t.Table=function(e){function n(t){n.__super__.constructor.call(this,"table",t)}return a(n,e),n.prototype.cssTypeName=function(){return"table"},n.prototype.typeName=function(){return"Table"},n.prototype.type=function(){return"Table"},n.prototype.firstSection=function(){var t;return(t=this.thead())?t:(t=this.tbody())?t:(t=this.tfoot())?t:null},n.prototype.lastSection=function(){var t;return(t=this.tfoot())?t:(t=this.tbody())?t:(t=this.thead())?t:null},n.prototype.tbody=function(){return this._getChild("tbody")},n.prototype.tfoot=function(){return this._getChild("tfoot")},n.prototype.thead=function(){return this._getChild("thead")},n.prototype._onMouseOver=function(t){return n.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},n.prototype._getChild=function(t){var e,n,r,i;for(i=this.children,n=0,r=i.length;n<r;n++)if(e=i[n],e.tagName()===t)return e;return null},n.droppers={Image:t.Element._dropBoth,ImageFixture:t.Element._dropVert,List:t.Element._dropVert,PreText:t.Element._dropVert,Static:t.Element._dropVert,Table:t.Element._dropVert,Text:t.Element._dropVert,Video:t.Element._dropBoth},n.fromDOMElement=function(e){var n,r,i,s,o,a,h,u,l,c,p,d;for(h=new this(this.getDOMElementAttributes(e)),i=function(){var t,r,i,s;for(i=e.childNodes,s=[],t=0,r=i.length;t<r;t++)n=i[t],s.push(n);return s}(),s=[],l=0,p=i.length;l<p;l++)if(r=i[l],1===r.nodeType&&(u=r.tagName.toLowerCase(),!h._getChild(u)))switch(u){case"tbody":case"tfoot":case"thead":a=t.TableSection.fromDOMElement(r),h.attach(a);break;case"tr":s.push(t.TableRow.fromDOMElement(r))}if(s.length>0)for(h._getChild("tbody")||h.attach(new t.TableSection("tbody")),c=0,d=s.length;c<d;c++)o=s[c],h.tbody().attach(o);return 0===h.children.length?null:h},n}(t.ElementCollection),t.TagNames.get().register(t.Table,"table"),t.TableSection=function(e){function n(t,e){n.__super__.constructor.call(this,t,e)}return a(n,e),n.prototype.cssTypeName=function(){return"table-section"},n.prototype.type=function(){return"TableSection"},n.prototype._onMouseOver=function(t){return n.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},n.fromDOMElement=function(e){var n,r,i,s,o,a;for(s=new this(e.tagName,this.getDOMElementAttributes(e)),i=function(){var t,r,i,s;for(i=e.childNodes,s=[],t=0,r=i.length;t<r;t++)n=i[t],s.push(n);return s}(),o=0,a=i.length;o<a;o++)r=i[o],1===r.nodeType&&"tr"===r.tagName.toLowerCase()&&s.attach(t.TableRow.fromDOMElement(r));return s},n}(t.ElementCollection),t.TableRow=function(e){function n(t){n.__super__.constructor.call(this,"tr",t)}return a(n,e),n.prototype.cssTypeName=function(){return"table-row"},n.prototype.isEmpty=function(){var t,e,n,r,i;for(i=this.children,n=0,r=i.length;n<r;n++)if(t=i[n],(e=t.tableCellText())&&e.content.length()>0)return!1;return!0},n.prototype.type=function(){return"TableRow"},n.prototype.typeName=function(){return"Table row"},n.prototype._onMouseOver=function(t){return n.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},n.droppers={TableRow:t.Element._dropVert},n.fromDOMElement=function(e){var n,r,i,s,o,a,h;for(s=new this(this.getDOMElementAttributes(e)),i=function(){var t,r,i,s;for(i=e.childNodes,s=[],t=0,r=i.length;t<r;t++)n=i[t],s.push(n);return s}(),a=0,h=i.length;a<h;a++)r=i[a],1===r.nodeType&&("td"!==(o=r.tagName.toLowerCase())&&"th"!==o||s.attach(t.TableCell.fromDOMElement(r)));return s},n}(t.ElementCollection),t.TableCell=function(e){function n(t,e){n.__super__.constructor.call(this,t,e)}return a(n,e),n.prototype.cssTypeName=function(){return"table-cell"},n.prototype.tableCellText=function(){return this.children.length>0?this.children[0]:null},n.prototype.type=function(){return"TableCell"},n.prototype.html=function(e){var n;return null==e&&(e=""),n=[e+"<"+this.tagName()+this._attributesToString()+">"],this.tableCellText()&&n.push(this.tableCellText().html(e+t.INDENT)),n.push(e+"</"+this.tagName()+">"),n.join(t.LINE_ENDINGS)},n.prototype._onMouseOver=function(t){return n.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},n.prototype._addDOMEventListeners=function(){},n.prototype._removeDOMEventListners=function(){},n.fromDOMElement=function(e){var n,r;return n=new this(e.tagName,this.getDOMElementAttributes(e)),r=new t.TableCellText(e.innerHTML.replace(/^\s+|\s+$/g,"")),n.attach(r),n},n}(t.ElementCollection),t.TableCellText=function(e){function n(t){n.__super__.constructor.call(this,"div",{},t)}return a(n,e),n.prototype.cssTypeName=function(){return"table-cell-text"},n.prototype.type=function(){return"TableCellText"},n.prototype._isInFirstRow=function(){var t,e,n,r;return t=this.parent(),e=t.parent(),n=e.parent(),r=n.parent(),n===r.firstSection()&&e===n.children[0]},n.prototype._isInLastRow=function(){var t,e,n,r;return t=this.parent(),e=t.parent(),n=e.parent(),r=n.parent(),n===r.lastSection()&&e===n.children[n.children.length-1]},n.prototype._isLastInSection=function(){var t,e,n;return t=this.parent(),e=t.parent(),n=e.parent(),e===n.children[n.children.length-1]&&t===e.children[e.children.length-1]},n.prototype.blur=function(){return this.isMounted()&&(this._domElement.blur(),this._domElement.removeAttribute("contenteditable")),t.Element.prototype.blur.call(this)},n.prototype.can=function(t,e){if(e)throw new Error("Cannot set behaviour for ListItemText");return this.parent().can(t)},n.prototype.html=function(e){var n;return null==e&&(e=""),(!this._lastCached||this._lastCached<this._modified)&&(n=t.TRIM_WHITESPACE?this.content.copy().trim():this.content.copy(),n.optimize(),this._lastCached=Date.now(),this._cached=n.html()),""+e+this._cached},n.prototype._onMouseDown=function(e){var n;return t.Element.prototype._onMouseDown.call(this,e),n=function(r){return function(){var i,s;return i=r.parent(),t.Root.get().dragging()===i.parent()?(t.Root.get().cancelDragging(),s=i.parent().parent().parent(),s.drag(e.pageX,e.pageY)):(i.parent().drag(e.pageX,e.pageY),r._dragTimeout=setTimeout(n,2*t.DRAG_HOLD_DURATION))}}(this),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(n,t.DRAG_HOLD_DURATION)},n.prototype._keyBack=function(t){var e,n,r,i;if(i=ContentSelect.Range.query(this._domElement),0===i.get()[0]&&i.isCollapsed()&&(t.preventDefault(),e=this.parent(),r=e.parent(),r.isEmpty()&&r.can("remove")))return 0===this.content.length()&&0===r.children.indexOf(e)?(n=this.previousContent(),n&&(n.focus(),i=new ContentSelect.Range(n.content.length(),n.content.length()),i.select(n.domElement())),r.parent().detach(r)):void 0},n.prototype._keyDelete=function(t){var e,n,r,i;if(r=this.parent().parent(),r.isEmpty()&&r.can("remove"))return t.preventDefault(),e=r.children[r.children.length-1],n=e.tableCellText().nextContent(),n&&(n.focus(),i=new ContentSelect.Range(0,0),i.select(n.domElement())),r.parent().detach(r)},n.prototype._keyDown=function(e){var n,r,i,s,o,a,h;if(h=ContentSelect.Range.query(this._domElement),this._atEnd(h)&&h.isCollapsed())return e.preventDefault(),n=this.parent(),this._isInLastRow()?(a=n.parent(),i=a.children[a.children.length-1].tableCellText(),s=i.nextContent(),s?s.focus():t.Root.get().trigger("next-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()}))):(o=n.parent().nextWithTest(function(t){return"TableRow"===t.type()}),r=n.parent().children.indexOf(n),r=Math.min(r,o.children.length),o.children[r].tableCellText().focus())},n.prototype._keyReturn=function(t){return t.preventDefault(),this._keyTab({shiftKey:!1,preventDefault:function(){}})},n.prototype._keyTab=function(e){var n,r,i,s,o,a,h,u,l,c;if(e.preventDefault(),n=this.parent(),e.shiftKey){if(this._isInFirstRow()&&n.parent().children[0]===n)return;return this.previousContent().focus()}if(this.can("spawn")){if(i=n.parent().parent(),"tbody"===i.tagName()&&this._isLastInSection()){for(a=new t.TableRow,c=n.parent().children,u=0,l=c.length;u<l;u++)r=c[u],s=new t.TableCell(r.tagName(),r._attributes),o=new t.TableCellText(""),s.attach(o),a.attach(s);return h=this.closest(function(t){return"TableSection"===t.type()}),h.attach(a),a.children[0].tableCellText().focus()}return this.nextContent().focus()}},n.prototype._keyUp=function(e){var n,r,i,s,o,a;if(a=ContentSelect.Range.query(this._domElement),0===a.get()[0]&&a.isCollapsed())return e.preventDefault(),n=this.parent(),this._isInFirstRow()?(o=n.parent(),i=o.children[0].previousContent(),i?i.focus():t.Root.get().trigger("previous-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()}))):(s=n.parent().previousWithTest(function(t){return"TableRow"===t.type()}),r=n.parent().children.indexOf(n),r=Math.min(r,s.children.length),s.children[r].tableCellText().focus())},n.droppers={},n.mergers={},n}(t.Text)}.call(this);