function cloudinaryImageUploader(e){function t(t){var a,i,r;n.angle+=t,n.angle<0?n.angle+=360:n.angle>270&&(n.angle-=360),r=n.width,a=n.height,n.width=a,n.height=r,n.maxWidth=r,i=[{c:"fit",h:600,w:600}],n.angle>0&&i.unshift({a:n.angle}),n.url=buildCloudinaryURL(n.filename,i),e.populate(n.url,[n.width,n.height])}var n,a,i,r;e.addEventListener("imageuploader.cancelupload",function(){a&&(a.upload.removeEventListener("progress",r),a.removeEventListener("readystatechange",i),a.abort()),e.state("empty")}),e.addEventListener("imageuploader.clear",function(){e.clear(),n=null}),e.addEventListener("imageuploader.fileready",function(t){function i(t){e.progress(t.loaded/t.total*100)}function r(t){var o;4==t.target.readyState&&(a=null,i=null,r=null,200==parseInt(t.target.status)?(o=JSON.parse(t.target.responseText),n={angle:0,height:parseInt(o.height),maxWidth:parseInt(o.width),width:parseInt(o.width)},n.filename=parseCloudinaryURL(o.url)[0],n.url=buildCloudinaryURL(n.filename,[{c:"fit",h:600,w:600}]),e.populate(n.url,[n.width,n.height])):new ContentTools.FlashUI("no"))}var o,l=t.detail().file;e.state("uploading"),e.progress(0),o=new FormData,o.append("file",l),o.append("upload_preset",CLOUDINARY_PRESET_NAME),a=new XMLHttpRequest,a.upload.addEventListener("progress",i),a.addEventListener("readystatechange",r),a.open("POST",CLOUDINARY_UPLOAD_URL,!0),a.send(o)}),e.addEventListener("imageuploader.rotateccw",function(){t(-90)}),e.addEventListener("imageUploader.rotatecw",function(){t(90)}),e.addEventListener("imageuploader.save",function(){var t,a,i,r;r=[],0!=n.angle&&r.push({a:n.angle}),t=e.cropRegion(),t.toString()!=[0,0,1,1].toString()&&(a={c:"crop",x:parseInt(n.width*t[1]),y:parseInt(n.height*t[0]),w:parseInt(n.width*(t[3]-t[1])),h:parseInt(n.height*(t[2]-t[0]))},r.push(a),n.width=a.w,n.height=a.h,n.maxWidth=a.w),(n.width>400||n.height>400)&&(r.push({c:"fit",w:400,h:400}),i=Math.min(400/n.width,400/n.height),n.width*=i,n.height*=i),n.url=buildCloudinaryURL(n.filename,r),n.maxWidth,e.save(n.url,[n.width,n.height])}),ContentEdit.Root.get().bind("taint",function(e){var t,n,a,i;"Image"==e.type()&&(t=parseCloudinaryURL(e.attr("src")),n=t[0],a=t[1],n&&(a.length>0&&"fill"==a[a.length-1].c&&a.pop(),a.push({c:"fill",w:e.size()[0],h:e.size()[1]}),(i=buildCloudinaryURL(n,a))!=e.attr("src")&&e.attr("src",i)))})}function buildCloudinaryURL(e,t){var n,a,i,r,o,l;for(o=[],n=0;n<t.length;n++){i=t[n],r=[];for(a in i)i.hasOwnProperty(a)&&r.push(a+"_"+i[a]);o.push(r.join(","))}return l=[CLOUDINARY_RETRIEVE_URL],o.length>0&&l.push(o.join("/")),l.push(e),l.join("/")}function parseCloudinaryURL(e){var t,n,a,i,r,o,l;for(e=e.replace(CLOUDINARY_RETRIEVE_URL,""),l=e.split("/"),l.shift(),t=l.pop(),l.length>0&&l[l.length-1].match(/v\d+/)&&l.pop(),o=[],n=0;n<l.length;n++){for(r=l[n].split(","),i={},a=0;a<r.length;a++)i[r[a].split("_")[0]]=r[a].split("_")[1];o.push(i)}return[t,o]}var CLOUDINARY_PRESET_NAME="ctpreset",CLOUDINARY_RETRIEVE_URL="https://res.cloudinary.com/andrewburns",CLOUDINARY_UPLOAD_URL="https://api.cloudinary.com/v1_1/andrewburns/image/upload";window.addEventListener("load",function(){var e;ContentTools.StylePalette.add([new ContentTools.Style("Author","author",["p"])]),e=ContentTools.EditorApp.get(),e.init("*[data-editable]","data-name"),ContentTools.IMAGE_UPLOADER=cloudinaryImageUploader,e.addEventListener("saved",function(e){var t;if(t=e.detail().regions,0!=Object.keys(t).length){this.busy(!0);document.getElementById("post_content").value=t["main-content"];var n=document.getElementById("status");console.log(n);var a=document.getElementById("post_picture");console.log(a);var i=document.getElementById("post_teams");i.value=document.getElementById("tags").value,console.log(i),$("#postsubmit").submit()}})});